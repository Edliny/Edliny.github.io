<p> hello everyone</p>
<p>个人主页</p>
<head runat="server">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
    <%--openlayers框架的引入--%>
    <script src="lib/openlayers/ol.js"></script>
    <%--<link href="lib/openlayers/control.css" rel="stylesheet" />--%>
    <link href="lib/openlayers/ol.css" rel="stylesheet" />
    <%--地图框架设计样式的引入--%>
    <link href="style/logo.css" rel="stylesheet" />
    <link href="style/leaflet.css" rel="stylesheet" />
    <link href="style/mainPage.css" rel="stylesheet" />
    <%--jquery框架的引入--%>
    <script src="lib/jquery/jquery-1.4.4.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="lib/jquery/jquery.cookie.js"></script>
    <script src="lib/jquery/jquery.session.js"></script>
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL,Object.assign"></script>
    <%--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/> --%>          
    <%--扩展ol的引入--%>
    <link href="lib/openlayers/ol-ext/dist/ol-ext.css" rel="stylesheet" />
    <script src="lib/openlayers/ol-ext/dist/ol-ext.js"></script>
    <link href="lib/openlayers/ol-ext/examples/style.css" rel="stylesheet" />
    <%--图层切换选择器的引入--%>
    <link href="style/ol-layerswitcher.css" rel="stylesheet" />
    <script src="lib/ol-layerswitcher.js"></script> 
    <%--目录树生成的引入--%>
    <link href="lib/zTree/demo.css" rel="stylesheet" />
    <link href="lib/zTree/zTreeStyle.css" rel="stylesheet" />
    <script src="lib/zTree/jquery.ztree.core.js"></script>
    <script src="lib/zTree/jquery.ztree.excheck.js"></script>
    <script src="lib/zTree/jquery.ztree.exedit.js"></script>
   
    <%--时间插件的引入--%>
    <script src="lib/laydate/laydate.js"></script>

    <%--<link rel="stylesheet" href="http://jrain.oscitas.netdna-cdn.com/tutorial/css/fontawesome-all.min.css"/> --%>  
   <%-- <link href="style/font-awesome.min.css" rel="stylesheet" />
    <link href="style/font-awesome.css" rel="stylesheet" />--%>
	<link href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>  
    <link href="lib/bootsnav/css/bootsnav.css" rel="stylesheet" />
    <script src="lib/bootsnav/js/bootsnav.js"></script>
    <link href="lib/bootsnav/css/btmap.css" rel="stylesheet" />

    <link href="lib/bootsnav/css/bootstrap-modal-bs3patch.css" rel="stylesheet" />
    <link href="lib/bootsnav/css/bootstrap-modal.css" rel="stylesheet" />
    
    <script src="lib/bootsnav/js/bootstrap-modalmanager.js"></script>
    <script src="lib/bootsnav/js/bootstrap-modal.js"></script>

    <link href="lib/login/css/login.css" rel="stylesheet" />
    <script src="lib/login/js/jquery.leanModal.min.js"></script>
   
    <%--复选下拉框--%>
    <link href="lib/jquery/jqueryselect/Select.css" rel="stylesheet" />
    <%--<script src="lib/jquery/jqueryselect/fSelect.js"></script>--%>
    <script src="lib/jquery/jqueryselect/fselectnew.js"></script>
    <link href="style/olpopup.css" rel="stylesheet" />

     <%--弹出框 --%>
    <link href="lib/jquery/jquerytctz/translucent/style.css" rel="stylesheet" />

    <script src="lib/jquery/jquerytctz/translucent/jquery-translucentn.js"></script>

    <title>GPS and InSAR Viewer - Tectonic Geodesy@GDUT</title>

    <style>
        /**********样式重置********************/
         .ol-zoom {
            top: 4.9em; 
            right:.5em;
            left: auto;
        }
        .layer-switcher button {
            width: 1.4em;
            height: 1.4em;
            background-size: 1.3em;
        }
       .layer-switcher {
            top: 9.15em;
        }
        .ol-full-screen {
            top: 2.7em;
        }
        .ol-attribution {
            right:.5em;
        }
        /**********样式重置********************/
        .ol-scale-line { /*比例尺样式设计*/
            left: 60%;
            bottom: 2.5%;
            z-index: 999;
            background: none;
        }

        .ol-scale-line-inner {
            border: 1px solid #0e0e0e;
            color: #0e0e0e;
            border-top: none;
            height: 14px;
        }

        .ol-control {
            background-color:#f2f3f7 ;/*rgb(70,130,180)*/
            border-radius: 0px;
            padding: 0px;
        }
        .ol-control button{
            color:black;
            background-color:#f2f3f7;
            font-size:1.45em;
        }
        .ol-popup {
            min-width: 200px;
        }
            /*.ol-control button {
                font-size: 1em;
                display: inline;
            }*/

        /*时间选择框设计*/
        .demo-input {
            height: 28px;
            min-width: 160px;
            line-height: 38px;
            border: 1px solid #e6e6e6;
            background-color: #fff;
            border-radius: 2px;
            padding-left: 10px;
        }
        /*查询下拉框的按钮的样式*/
        .SearchPoint {
            border: 1px solid #dce1e6;
            border-radius: 5px;
        }
        /*file按钮的控件下拉框的样式*/
        .filebox {
            color: black;
            border: 1px solid #dce1e6;
            box-shadow: 0 1px 2px #fff inset,0 -1px 0 #a8abae inset;
            background: #fff;
            /* border-radius: 5px;*/
        }

        .gpssearchbox {
            color: #8c96a0;
            border: 1px solid #dce1e6;
            box-shadow: 0 1px 2px #fff inset,0 -1px 0 #a8abae inset;
            background: -webkit-linear-gradient(top,#f2f3f7,#e4e8ec);
            border-radius: 5px;
        }

        div.zTreeDemoBackground {
            width: 12%;
            height: 100%;
            text-align: left;
        }

        ul.ztree {
            margin: 1px 0px;
            border: 1px solid #dce1e6;
            background: #f0f6e4;
            width: 230px;
            height: 100px;
            overflow-y: scroll;
            overflow-x: auto;
            color: #8c96a0;
            /*box-shadow: 0 1px 2px #fff inset,0 -1px 0 #a8abae inset;*/
            background: -webkit-linear-gradient(top,#f2f3f7,#e4e8ec);
            background: -moz-linear-gradient(top,#f2f3f7,#e4e8ec);
            background: #fff;
            border-radius: 5px;
        }

        #map-type-menu {
            background: #fff;
            font-family: 'Open Sans', sans-serif;
            width: 230px;
            min-height: 34px;
        }

        hr {
            margin-top: 1px;
            margin-bottom: 1px;
            border: 0;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        /************按钮设计******************/
        #top-map-buttons {
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: 1000;
            max-width: 80%;
        }

            #top-map-buttons > * {
                float: left;
                z-index: 99;
                margin-left: 1px;
                border-radius: 0px;
                padding: 0rem .3rem;
                color: #f8f9fa;
            }

            #top-map-buttons > .btn {
                background-color: rgb(70,130,180);
                margin-right: 0.2%;
            }
        /******************************/
        /***搜索框样式重置*****/
        .ol-search {
            top: 0em;
            left: 30%;
        }

        /*浮云窗的样式的设置*******************************/
        .ol-overlay > div {
            width: 100%;
            height: 100%;
        }

        .ol-overlay img {
            margin: auto;
            display: block;
            min-height: 80%;
            max-width: 100%;
            max-height: 80%;
        }

        .ol-overlay p {
            margin: 0;
            text-align: center;
        }

            .ol-overlay p.copy {
                font-size: 0.8em;
                text-align: initial;
            }
        /*浮云窗的样式的设置*******************************/
        /****目录树按钮*****/
        .ztree li span.button.add {
            margin-left: 2px;
            margin-right: -1px;
            background-position: -144px 0;
            vertical-align: top;
            *vertical-align: middle;
        }

        /*layers显示的样式*/
        .menu_list {
            width: 268px;
            margin: 0 auto;
        }

        .menu_head {
            height: 47px;
            line-height: 47px;
            padding-left: 38px;
            font-size: 14px;
            color: #525252;
            cursor: pointer;
            border-left: 1px solid #e1e1e1;
            border-right: 1px solid #e1e1e1;
            border-bottom: 1px solid #e1e1e1;
            border-top: 1px solid #F1F1F1;
            position: relative;
            margin: 0px;
            font-weight: bold;
            background: #f1f1f1 url(image/pro_left.png) center right no-repeat;
        }

        .menu_list .current {
            background: #f1f1f1 url(image/pro_down.png) center right no-repeat;
        }

        .menu_body {
            line-height: 38px;
            border-left: 1px solid #e1e1e1;
            backguound: #fff;
            border-right: 1px solid #e1e1e1;
        }

            .menu_body a {
                display: block;
                height: 38px;
                line-height: 0px;
                padding-left: 38px;
                color: #777777;
                background: #fff;
                text-decoration: none;
                border-bottom: 1px solid #e1e1e1;
            }

                .menu_body a:hover {
                    text-decoration: none;
                }

        .map { /*地图的样式*/
            height: 50%;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
    </style>

</head>
<body>
    <%--第一步、设置工具栏：主要完成两个工具（文件File和GPS查询（Tools））--%>
    <%--第二步、加载地图--%>
    <div id="map" class="map">
        <div id="top-map-buttons" style="display:none;">            
            <button class="btn btn-primary-outline">Layers</button>    
            <button class="btn btn-primary-outline" id="insar-search">InSAR</button> 
            <button class="btn btn-primary-outline" id="gps-search">GPS</button> 
            <button class="btn btn-primary-outline" id="Adminmanagement" style="display:none;">User Management</button>
            <input type="button"  class="btn btn-primary-outline" />
            <input type="text" id="logmess" style= "background-color:transparent;width:15%;height:26px;color:red;font-weight:bold;border:0px;" value="guest" />
        </div>
        <div class="htmleaf-container" style="z-index:999;position:fixed;top:2px;">
            <div class="demo" style="height:50px;">
                <div class="container" style="margin-left: initial;">
                    <div class="row">
                        <div class="col-md-12">
	                    <nav class="navbar navbar-default navbar-mobile bootsnav" style="width: 350px;min-height: 30px;">
	                        <div class="navbar-header">
	                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
	                                <i class="fa fa-bars"></i>
	                            </button>
	                        </div>
	                        <div class="collapse navbar-collapse" id="navbar-menu">
	                            <ul class="nav navbar-nav" data-in="fadeInDown" data-out="fadeOutUp">
	                                <li><a href="#" data-hover="About" id="file">Layers </a></li><%--<span data-hover="About"></span>--%>
	                                <li class="dropdown">
	                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="Shortcodes">InSAR<%-- <span data-hover="Shortcodes"></span>--%></a>
	                                    <ul class="dropdown-menu">
	                                        <li><a href="#" id="ipro">Search</a></li>
	                                        <li><a href="#">Edit</a></li>	                                       
	                                        <li><a href="#">Run</a></li>                              
	                                    </ul>
	                                </li>
	                                <li class="dropdown">
	                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="Pages">GPS<%-- <span data-hover="Pages"></span>--%></a>
	                                    <ul class="dropdown-menu">
	                                        <li><a href="#" id="gpro">Search</a></li>
	                                        <li><a id="Datamanagement" href="#" data-toggle="modal">Edit</a></li>                                
	                                        <li><a href="#">Run</a></li>                                    
	                                    </ul>
	                                </li>
                                    <li><a href="#loginmodal" data-hover="Portfolio" id="login" >Login</a></li>
                                    
                                    <%--<li class="dropdown">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="Pages">User</a>
                                        <ul class="dropdown-menu">
	                                         
                                            <li><a href="#" data-hover="Portfolio" id="" >User Management</a></li> 
                                        </ul>
                                    </li>--%>        
	                            </ul>
	                        </div>
	                    </nav>
	                </div>
	            </div>
	        </div>
	    </div>       
	    </div>
    <div id="loginmodal" style="display:none;width:300px;position:absolute;margin-left:-150px;margin-top:-200px;top:50%;left:50%;z-index:999;">
        <p style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size: 2.5em;line-height: 1.5em;letter-spacing: -0.05em;margin-bottom: 20px;padding: .1em 0;color: #444;position: relative;overflow: hidden;white-space: nowrap;text-align: center;">
            User Login
            <button id="Close_Login" type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        </p>
        <form id="loginform" name="loginform" method="post" action="index.html">
            <label for="username">Username:</label>
            <input type="text" name="username" id="username" class="txtfield" tabindex="1" value=""/>               
            <label for="password">Password:</label>
            <input type="password" name="password" id="password" class="txtfield" tabindex="2" value=""/>   
            <div class="center">
                <input type="button" name="loginbtn" id="loginbtn" class="flatbtn-blu hidemodal" value="Log In" tabindex="3"/>
            </div>  
        </form>
    </div>

        <div id="InSAR_popup" class="ol-popup">
            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
            <div id="popup-content"></div>
        </div>

        <div id="insarchart" style="display:none;text-align: center;position: absolute;bottom: 0.5%;left: 0.5%;z-index: 100;height: 330px;width:760px;background-color: white;box-shadow: silver 2px 3px 16px;transform: translateY(0px);transition: all 0.5s ease 0s;border-radius: 4px;">            
            <div style="position:absolute;top:5px;right:15px;z-index:3;">
                <button type="button" id="chart_hide" style="background-position:0 -208px;padding: 0 !important;border: 0 !important;width: 16px;height: 16px;background-image: url(https://cdnjs.cloudflare.com/ajax/libs/extjs/6.0.0/classic/theme-neptune/resources/images/tools/tool-sprites.png) !important;background-color: grey;"></button>
            </div>
            <div class="content" style="height: 100%;">
                <div style="height:100%;box-sizing:border-box;">
                    <div class="chart-containers clearfix">
                        <div class="side-item" style="width:100%;overflow:hidden;height: 100%;" data-highcharts-chart="25">
                            <div id="highcharts-vcwhpjv-3668" style="position: relative; overflow: hidden; width: 100%; height: 100%; text-align: left; line-height: normal; z-index: 0; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dir="ltr" class="highcharts-container ">
                                <svg version="1.1" class="highcharts-root" style="font-family:&quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Arial, Helvetica, sans-serif;font-size:12px;" xmlns="http://www.w3.org/2000/svg" width="757" height="100%" viewBox="0 0 40% 40%">
                                    <desc>Created with Highcharts 7.2.0</desc>
                                    <defs>
                                        <clipPath id="highcharts-vcwhpjv-3669-">
                                            <rect x="0" y="0" width="586" height="427" fill="none"></rect>
                                        </clipPath>
                                        <clipPath id="highcharts-vcwhpjv-3732-">
                                            <rect x="0" y="0" width="586" height="427" fill="none"></rect>
                                        </clipPath>
                                        <clipPath id="highcharts-vcwhpjv-3795-">
                                            <rect x="0" y="0" width="586" height="40" fill="none"></rect>
                                        </clipPath>
                                    </defs>
                                    <rect fill="#ffffff" class="highcharts-background" x="0" y="0" width="100%" height="100%" rx="0" ry="0"></rect>                                    
                                    <g class="highcharts-plot-lines-0" data-z-index="0">
                                        <path fill="none" class="highcharts-plot-line " stroke="#808080" stroke-width="1" d="M 82 57.5 L 678 57.5"></path>
                                        <path fill="none" class="highcharts-plot-line " stroke="#808080" stroke-width="1" d="M 82 272.5 L 678 272.5"></path>
                                        <path fill="none" class="highcharts-plot-line " stroke="#7cb5ec" stroke-width="1" d="M 82 272.5 L 82 57.5"></path>
                                        <path fill="none" class="highcharts-plot-line " stroke="#FF8000" stroke-width="1" d="M 678 272.5 L 678 57.5"></path>
                                    </g>
                                    <g class="highcharts-grid highcharts-xaxis-grid" data-z-index="1">
                                        <path fill="none" data-z-index="1" class="highcharts-grid-line" d="M 148.5 58 L 148.5 485" opacity="1"></path>
                                        <path fill="none" data-z-index="1" class="highcharts-grid-line" d="M 241.5 58 L 241.5 485" opacity="1"></path>
                                        <path fill="none" data-z-index="1" class="highcharts-grid-line" d="M 336.5 58 L 336.5 485" opacity="1"></path>
                                        <path fill="none" data-z-index="1" class="highcharts-grid-line" d="M 431.5 58 L 431.5 485" opacity="1"></path>
                                        <path fill="none" data-z-index="1" class="highcharts-grid-line" d="M 524.5 58 L 524.5 485" opacity="1"></path>
                                        <path fill="none" data-z-index="1" class="highcharts-grid-line" d="M 619.5 58 L 619.5 485" opacity="1"></path>
                                    </g>                                    
                                    <g class="highcharts-grid highcharts-yaxis-grid" data-z-index="1">                                   </g>
                                    <g class="highcharts-grid highcharts-yaxis-grid highcharts-navigator-yaxis" data-z-index="1">
                                        <path fill="none" data-z-index="1" class="highcharts-grid-line" d="M 81 561.5 L 667 561.5" opacity="1"></path>
                                    </g>
                                    <rect fill="none" class="highcharts-plot-border" data-z-index="1" x="81" y="58" width="586" height="427"></rect>                                    
                                    <g class="highcharts-axis highcharts-xaxis" data-z-index="2">
                                        <path fill="none" class="highcharts-tick" stroke="#7cb5ec" stroke-width="1" d="M 82 219 L 92 219" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#7cb5ec" stroke-width="1" d="M 82 166 L 92 166" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#7cb5ec" stroke-width="1" d="M 82 112 L 92 112" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#FF8000" stroke-width="1" d="M 668 219 L 678 219" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#FF8000" stroke-width="1" d="M 668 166 L 678 166" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#FF8000" stroke-width="1" d="M 668 112 L 678 112" opacity="1"></path>

                                        <path fill="none" class="highcharts-tick" stroke="#ccd6eb" stroke-width="1" d="M 119.25 273 L 119.25 263" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#ccd6eb" stroke-width="1" d="M 193.75 273 L 193.75 263" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#ccd6eb" stroke-width="1" d="M 268.25 273 L 268.25 263" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#ccd6eb" stroke-width="1" d="M 342.75 273 L 342.75 263" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#ccd6eb" stroke-width="1" d="M 417.25 273 L 417.25 263" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#ccd6eb" stroke-width="1" d="M 491.75 273 L 491.75 263" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#ccd6eb" stroke-width="1" d="M 566.25 273 L 566.25 263" opacity="1"></path>
                                        <path fill="none" class="highcharts-tick" stroke="#ccd6eb" stroke-width="1" d="M 640.75 273 L 640.75 263" opacity="1"></path>
                                        <%--<text x="374" data-z-index="7" text-anchor="middle" transform="translate(0,0)" class="highcharts-axis-title" style="color:#666666;fill:#666666;" y="312">
                                            <tspan>Date</tspan>
                                        </text>--%>
                                        <path fill="none" class="highcharts-axis-line" stroke="#ccd6eb" stroke-width="1" data-z-index="7" d="M 82 272.5 L 678 272.5"></path>
                                    </g>
                                    <g class="highcharts-axis highcharts-xaxis highcharts-navigator-xaxis" data-z-index="2"><path fill="none" class="highcharts-axis-line" data-z-index="7" d="M 81 577 L 667 577"></path></g>
                                    <g class="highcharts-axis highcharts-yaxis" data-z-index="2">
                                        <text x="130" data-z-index="7" text-anchor="middle" transform="translate(0,0) rotate(270 25.625 271.5)" class="highcharts-axis-title" style="color:#666666;fill:#666666;" y="285">
                                        <tspan>Cumulative Disp.[mm]</tspan>
                                        <%--<tspan x="130.625" dy="15"></tspan>--%>
                                        </text>
                                        <path fill="none" class="highcharts-axis-line" data-z-index="7" d="M 81 58 L 81 485"></path>
                                    </g>
                                    <g class="highcharts-axis highcharts-yaxis" data-z-index="2">
                                        <text x="130" text-anchor="middle" transform="translate(0,0) rotate(270 25.625 271.5)" class="highcharts-axis-title" style="color:#666666;fill:#666666;" y="975" data-z-index="7">
                                        <tspan>Incremental Disp.[mm]</tspan>
                                        <%--<tspan x="130.625" dy="-15"></tspan>--%>
                                        </text>
                                        <path fill="none" class="highcharts-axis-line" data-z-index="7" d="M 81 58 L 81 785"></path>
                                    </g>
                                    <g class="highcharts-axis highcharts-yaxis highcharts-navigator-yaxis" data-z-index="2">
                                        <path fill="none" class="highcharts-axis-line" data-z-index="7" d="M 81 537 L 81 577"></path>
                                    </g>
                                    <g class="highcharts-series-group" data-z-index="3">
                                        <g data-z-index="0.1" class="highcharts-series highcharts-series-0 highcharts-scatter-series highcharts-color-0  highcharts-tracker" transform="translate(81,58) scale(1 1)" clip-path="url(#highcharts-vcwhpjv-3732-)"></g>
                                        
                                        <g id="chart_line" data-z-index="0.1" class="highcharts-series highcharts-series-0 highcharts-line-series highcharts-color-0" transform="translate(92,58) scale(1 1)" clip-path="url(#highcharts-2f92nj3-305-)">
                                            <%--<path fill="none" d="M 0 109.97816022237237 L 19.752808988764 206.3191196266562 L 26.337078651685 168.83050620307426 L 46.089887640449 246.90665322417982 L 59.258426966292 146.91207438459008 L 79.011235955056 82.17578598360166 L 92.179775280899 167.87070496380238 L 98.76404494382 232.32667641776308 L 105.34831460674 88.10614499946536 L 138.26966292135 200.94676720040545 L 151.43820224719 214.15367466314154 L 164.60674157303 230.18093222193426 L 177.77528089888 244.0884251371019 L 190.94382022472 242.55119752511277 L 204.11235955056 208.18910986169544 L 230.44943820225 151.83934924254748 L 256.78651685393 67.45435494681152 L 269.95505617978 41.533247341712865 L 329.21348314607 217.98986710980543 L 335.79775280899 198.7942081851263 L 342.38202247191 236.5180846589308 L 348.96629213483 226.38119383156294 L 355.55056179775 271.2907187988367 L 362.13483146067 177.63365428025443 L 368.7191011236 204.7123844353482 L 375.30337078652 206.2401308187594 L 381.88764044944 195.95189691583332 L 388.47191011236 406.79164167245335 L 395.05617977528 175.8863483592871 L 401.6404494382 226.73817584042757 L 408.22471910112 165.59739996741365 L 414.80898876404 102.0953136781863 L 421.39325842697 213.5 L 427.97752808989 97.81145533919357 L 434.56179775281 34.68713354070991 L 441.14606741573 147.70131557931586 L 447.73033707865 170.5535910812515 L 454.31460674157 41.28047467271574 L 460.89887640449 175.14969302093093 L 467.48314606742 168.21794394155302 L 474.06741573034 91.53883093098915 L 480.65168539326 196.0022067471096 L 487.23595505618 36.16301584740535 L 493.8202247191 216.23575216881 L 500.40449438202 44.399697467683666 L 506.98876404494 183.43321277201193 L 513.57303370787 190.27241498604423 L 520.15730337079 108.73394731183839 L 526.74157303371 140.1534702355662 L 533.32584269663 165.54537350684342 L 539.91011235955 204.73291505655888 L 546.49438202247 202.95570134402567 L 553.07865168539 188.24569749087095 L 559.66292134831 154.36055406679696 L 566.24719101124 203.13602430342382 L 572.83146067416 211.7719776585388 L 579.41573033708 174.4170568486068 L 586 222.5202718569587" class="highcharts-graph" data-z-index="1" stroke="#7cb5ec" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"></path>--%>
                                            <%--<path fill="none" d="M -10 109.97816022237237 L 0 109.97816022237237 L 19.752808988764 206.3191196266562 L 26.337078651685 168.83050620307426 L 46.089887640449 246.90665322417982 L 59.258426966292 146.91207438459008 L 79.011235955056 82.17578598360166 L 92.179775280899 167.87070496380238 L 98.76404494382 232.32667641776308 L 105.34831460674 88.10614499946536 L 138.26966292135 200.94676720040545 L 151.43820224719 214.15367466314154 L 164.60674157303 230.18093222193426 L 177.77528089888 244.0884251371019 L 190.94382022472 242.55119752511277 L 204.11235955056 208.18910986169544 L 230.44943820225 151.83934924254748 L 256.78651685393 67.45435494681152 L 269.95505617978 41.533247341712865 L 329.21348314607 217.98986710980543 L 335.79775280899 198.7942081851263 L 342.38202247191 236.5180846589308 L 348.96629213483 226.38119383156294 L 355.55056179775 271.2907187988367 L 362.13483146067 177.63365428025443 L 368.7191011236 204.7123844353482 L 375.30337078652 206.2401308187594 L 381.88764044944 195.95189691583332 L 388.47191011236 406.79164167245335 L 395.05617977528 175.8863483592871 L 401.6404494382 226.73817584042757 L 408.22471910112 165.59739996741365 L 414.80898876404 102.0953136781863 L 421.39325842697 213.5 L 427.97752808989 97.81145533919357 L 434.56179775281 34.68713354070991 L 441.14606741573 147.70131557931586 L 447.73033707865 170.5535910812515 L 454.31460674157 41.28047467271574 L 460.89887640449 175.14969302093093 L 467.48314606742 168.21794394155302 L 474.06741573034 91.53883093098915 L 480.65168539326 196.0022067471096 L 487.23595505618 36.16301584740535 L 493.8202247191 216.23575216881 L 500.40449438202 44.399697467683666 L 506.98876404494 183.43321277201193 L 513.57303370787 190.27241498604423 L 520.15730337079 108.73394731183839 L 526.74157303371 140.1534702355662 L 533.32584269663 165.54537350684342 L 539.91011235955 204.73291505655888 L 546.49438202247 202.95570134402567 L 553.07865168539 188.24569749087095 L 559.66292134831 154.36055406679696 L 566.24719101124 203.13602430342382 L 572.83146067416 211.7719776585388 L 579.41573033708 174.4170568486068 L 586 222.5202718569587 L 586 222.5202718569587" visibility="visible" data-z-index="2" class="highcharts-tracker-line" stroke-linejoin="round" stroke="rgba(192,192,192,0.0001)" stroke-width="22"></path>--%>
                                        </g>


                                        <g id="chart_pt" data-z-index="0.1" class="highcharts-markers highcharts-series-0 highcharts-scatter-series highcharts-color-0  highcharts-tracker" transform="translate(81,58) scale(1 1)"></g></g>
                                    <text x="359" text-anchor="middle" class="highcharts-title" data-z-index="4" style="color:#333333;font-size:18px;font-size:10px;fill:#333333;" y="24">
                                        <tspan id="charthead"></tspan>
                                        
                                    </text>
                                    <text x="10" text-anchor="start" class="highcharts-caption" data-z-index="4" style="color:#666666;fill:#666666;" y="607"></text>
                                    <text x="359" text-anchor="middle" class="highcharts-subtitle" data-z-index="4" style="color:#666666;fill:#666666;" y="39">
                                        <tspan id="chart_v"></tspan>
                                        <%--velocity: -6.08 mm/yr,  v_std: 4.09 mm/yr--%><%--S1 IW 165 550 D--%>
                                    </text>
                                    <g class="highcharts-legend" data-z-index="7">
                                        <rect fill="none" class="highcharts-legend-box" rx="0" ry="0" x="0" y="0" width="8" height="8" visibility="hidden"></rect>
                                        <g data-z-index="1"></g>
                                    </g>                           
                                    <g class="highcharts-axis-labels highcharts-xaxis-labels highcharts-navigator-xaxis" data-z-index="7">
                                        <text x="99.25" style="color:#999999;cursor:default;font-size:11px;fill:#999999;" text-anchor="start" transform="translate(0,0)" y="290" opacity="1">
                                            <tspan id="date_axis_1"></tspan>
                                        </text>
                                        <text x="173.75" style="color:#999999;cursor:default;font-size:11px;fill:#999999;" text-anchor="start" transform="translate(0,0)" y="290" opacity="1">
                                            <tspan id="date_axis_2"></tspan>
                                        </text>
                                        <text x="248.25" style="color:#999999;cursor:default;font-size:11px;fill:#999999;" text-anchor="start" transform="translate(0,0)" y="290" opacity="1">
                                            <tspan id="date_axis_3"></tspan>
                                        </text>
                                        <text x="322.75" style="color:#999999;cursor:default;font-size:11px;fill:#999999;" text-anchor="start" transform="translate(0,0)" y="290" opacity="1">
                                            <tspan id="date_axis_4"></tspan>
                                        </text>
                                        <text x="397.25" style="color:#999999;cursor:default;font-size:11px;fill:#999999;" text-anchor="start" transform="translate(0,0)" y="290" opacity="1">
                                            <tspan id="date_axis_5"></tspan>
                                        </text>
                                        <text x="471.75" style="color:#999999;cursor:default;font-size:11px;fill:#999999;" text-anchor="start" transform="translate(0,0)" y="290" opacity="1">
                                            <tspan id="date_axis_6"></tspan>
                                        </text><%--2007.042007.102008.042008.102009.042009.102010.042010.10--%>
                                        <text x="546.25" style="color:#999999;cursor:default;font-size:11px;fill:#999999;" text-anchor="start" transform="translate(0,0)" y="290" opacity="1">
                                            <tspan id="date_axis_7"></tspan>
                                        </text>
                                        <text x="620.75" style="color:#999999;cursor:default;font-size:11px;fill:#999999;" text-anchor="start" transform="translate(0,0)" y="290" opacity="1">
                                            <tspan id="date_axis_8"></tspan>
                                        </text>
                                    </g> 
                                    <g class="highcharts-axis-labels highcharts-yaxis-labels" data-z-index="7">
                                        <text id="axis_c_b1" x="66" style="color:#7cb5ec;cursor:default;font-size:11px;fill:#7cb5ec;" text-anchor="end" transform="translate(0,0)" y="273" opacity="1">-16</text>
                                        <text id="axis_c_b2" x="66" style="color:#7cb5ec;cursor:default;font-size:11px;fill:#7cb5ec;" text-anchor="end" transform="translate(0,0)" y="219" opacity="1">-8</text>
                                        <text id="axis_c_m" x="66" style="color:#7cb5ec;cursor:default;font-size:11px;fill:#7cb5ec;" text-anchor="end" transform="translate(0,0)" y="166" opacity="1">0</text>
                                        <text id="axis_c_t2" x="66" style="color:#7cb5ec;cursor:default;font-size:11px;fill:#7cb5ec;" text-anchor="end" transform="translate(0,0)" y="112" opacity="1">8</text>
                                        <text id="axis_c_t1" x="66" style="color:#7cb5ec;cursor:default;font-size:11px;fill:#7cb5ec;" text-anchor="end" transform="translate(0,0)" y="62" opacity="1">16</text>

                                        <text id="axis_i_b1" x="702" style="color:#FF8000;cursor:default;font-size:11px;fill:#FF8000;" text-anchor="end" transform="translate(0,0)" y="273" opacity="1">-8</text>
                                        <text id="axis_i_b2" x="702" style="color:#FF8000;cursor:default;font-size:11px;fill:#FF8000;" text-anchor="end" transform="translate(0,0)" y="219" opacity="1">-4</text>
                                        <text id="axis_i_m" x="702" style="color:#FF8000;cursor:default;font-size:11px;fill:#FF8000;" text-anchor="end" transform="translate(0,0)" y="166" opacity="1">0</text>
                                        <text id="axis_i_t2" x="702" style="color:#FF8000;cursor:default;font-size:11px;fill:#FF8000;" text-anchor="end" transform="translate(0,0)" y="112" opacity="1">4</text>
                                        <text id="axis_i_t1" x="702" style="color:#FF8000;cursor:default;font-size:11px;fill:#FF8000;" text-anchor="end" transform="translate(0,0)" y="62" opacity="1">8</text>
                                    </g>
                                    <g class="highcharts-axis-labels highcharts-yaxis-labels highcharts-navigator-yaxis" data-z-index="7"></g>                                    
                                    <g class="highcharts-label highcharts-tooltip highcharts-color-0" style="pointer-events:none;white-space:nowrap;" data-z-index="8" transform="translate(534,-9999)" opacity="0" visibility="visible">
                                        <path fill="none" class="highcharts-label-box highcharts-tooltip-box highcharts-shadow" d="M 3.5 0.5 L 169.5 0.5 C 172.5 0.5 172.5 0.5 172.5 3.5 L 172.5 31.5 C 172.5 34.5 172.5 34.5 169.5 34.5 L 91.5 34.5 85.5 40.5 79.5 34.5 3.5 34.5 C 0.5 34.5 0.5 34.5 0.5 31.5 L 0.5 3.5 C 0.5 0.5 0.5 0.5 3.5 0.5" stroke="#000000" stroke-opacity="0.049999999999999996" stroke-width="5" transform="translate(1, 1)"></path>
                                        <path fill="none" class="highcharts-label-box highcharts-tooltip-box highcharts-shadow" d="M 3.5 0.5 L 169.5 0.5 C 172.5 0.5 172.5 0.5 172.5 3.5 L 172.5 31.5 C 172.5 34.5 172.5 34.5 169.5 34.5 L 91.5 34.5 85.5 40.5 79.5 34.5 3.5 34.5 C 0.5 34.5 0.5 34.5 0.5 31.5 L 0.5 3.5 C 0.5 0.5 0.5 0.5 3.5 0.5" stroke="#000000" stroke-opacity="0.09999999999999999" stroke-width="3" transform="translate(1, 1)"></path>
                                        <path fill="none" class="highcharts-label-box highcharts-tooltip-box highcharts-shadow" d="M 3.5 0.5 L 169.5 0.5 C 172.5 0.5 172.5 0.5 172.5 3.5 L 172.5 31.5 C 172.5 34.5 172.5 34.5 169.5 34.5 L 91.5 34.5 85.5 40.5 79.5 34.5 3.5 34.5 C 0.5 34.5 0.5 34.5 0.5 31.5 L 0.5 3.5 C 0.5 0.5 0.5 0.5 3.5 0.5" stroke="#000000" stroke-opacity="0.15" stroke-width="1" transform="translate(1, 1)"></path>
                                        <path fill="rgba(247,247,247,0.85)" class="highcharts-label-box highcharts-tooltip-box" d="M 3.5 0.5 L 169.5 0.5 C 172.5 0.5 172.5 0.5 172.5 3.5 L 172.5 31.5 C 172.5 34.5 172.5 34.5 169.5 34.5 L 91.5 34.5 85.5 40.5 79.5 34.5 3.5 34.5 C 0.5 34.5 0.5 34.5 0.5 31.5 L 0.5 3.5 C 0.5 0.5 0.5 0.5 3.5 0.5" stroke="#7cb5ec" stroke-width="1"></path>
                                        <text x="8" data-z-index="1" style="font-size:12px;color:#333333;cursor:default;fill:#333333;" y="20">
                                            <tspan>1. Sep 2018: 1.398466 cm</tspan></text></g></svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="insarexpand" class="modal" tabindex="-1"  style="width:360px;z-index:999;position:fixed; display: none;top: 330px;left:390px;opacity: 1;margin-left: -379px;margin-top: -273.5px">
            <div class="modal-header">
                <button id="Search_InSAR_CloseBt" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">InSAR Search</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6" style="width: 100%;font-size:smaller;">
                        <p style="margin-bottom: 16px;">
                            <label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Project</label>                                                       
                            <select id="iproject" class="form-control" style="width:80%;"  multiple="multiple"></select>
                        </p>
                        <p style="margin-bottom: 16px;">
                            <label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Satellite</label>
                            <select id="isatellite" class="form-control" style="width:80%;">
                                <option>All</option>
                                <option>ALOS</option>
                                <option>COSMO-SKYMED</option>
                                <option>TERRASAR-X</option>
                                <option>CSK</option>
                                <option>ALOS2</option>
                                <option>TSX</option>
                                <option selected="selected">S1</option>
                                <option>ENV</option>
                            </select>
                        </p>
                        <p style="margin-bottom: 16px;"><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Track</label>
                            <select id="itrack" class="form-control" style="width:80%;">
                                <option>All</option>
                                <option>004</option>
                                <option>005</option>
                                <option>011</option>
                                <option>012</option>
                                <option>018</option>
                                <option selected="selected">025</option>
                                <option>026</option>
                                <option>027</option>
                                <option>033</option>
                                <option>040</option>
                                <option>047</option>
                                <option>048</option>
                                <option>055</option>
                                <option>062</option>
                                <option>063</option>
                                <option>175</option>
                                <option>297</option>
                                <option>128</option>
                                <option>164</option>
                            </select>
                        </p>   
                        
                        <p style="margin-bottom: 16px;"><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Frame</label>
                            <select id="iframe" class="form-control" style="width:80%;">
                                <option>All</option>
                                <option selected="selected">N/A</option>
                            </select>
                        </p>
                        <p style="margin-bottom: 16px;"><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Mode</label>
                            <select id="imode" class="form-control" style="width:80%;">
                                <option>All</option>
                                <option>StripMap</option>
                                <option>SpotLight</option>
                                <option>HIMAGE</option>
                                <option selected="selected">IW</option>
                                <option>Scansar</option>
                            </select>
                        </p>
                        <p style="margin-bottom: 16px;"><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Flight Dir.</label>
                            <select id="iflight_Dir" class="form-control" style="width:80%;">
                                 <option>All</option>
                                 <option>D</option>
                                <option selected="selected">A</option>
                            </select>
                        </p>
                        <p style="margin-bottom: 16px;"><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Date</label>          
                            <input type="text" id="idate" class="form-control" style="width: 80%;" placeholder="Please choose date..." />
                        </p>
                        <p style="margin-bottom: 16px;"><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Form</label>
                            <select id="iform" class="form-control" style="width:80%;">
                                <option>All</option>
                                <option selected="selected">PointCloud</option>
                                <option>KML</option>
                            </select>
                        </p>
                    </div>
                </div>
            </div>
  <div class="modal-footer">
    <button id="CloseInSAR" type="button" data-dismiss="modal" class="btn btn-default">Close</button>
    <button id="Search_InSAR" type="button" class="btn btn-primary">Search</button>
  </div>
</div>

        <%--GPS按钮下的Run按钮点击后，弹出的数据处理运行的参数选择窗体--%>
        <div id="GPSRun_Para" style="display:none;font-weight:700;text-align:center;font-size:4em;position: fixed;top:30%;left:30%;z-index:99;height:40%;width:40%;color:black;background:rgba(0,60,136,.5);">
            
        </div>
        <%--GPS按钮下的Run按钮点击后，弹出的数据处理运行的参数选择窗体--%>

        <%--GPS按钮下的Run按钮点击后，弹出的数据处理运行的参数选择窗体--%>
        <div id="gpspopup" class="modal" tabindex="-1"  style="width:15%;min-width:300px;z-index:999;position:fixed; display: none;top: 60%;left:103.5%;opacity: 1;margin-left: -379px;margin-top: -273.5px">
            <div class="modal-header">
                <button id="CloseGPSPopup" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 id="siteText" class="modal-title" style="font-size:18px;"></h4>
            </div>        
            <div class="modal-body">
                <div class="row" >
                    <div class="col-md-6" style="width: 100%;font-size:12px;">                                  
                        <p style="height:10px;"><label style="width:25%;float: left;border:0px;border-color:white;text-align: left;">B,L,H</label>
                            <label id="BLHText" style="width:75%;float: left;border:0px;border-color:white;text-align: center;"></label>
                        </p>
                        <hr />
                        <p style="height:10px;"><label style="width:25%;float: left;border:0px;border-color:white;text-align: left;">Ve,Vn,Vu</label>
                            <label id="vENUText" style="width:75%;float: left;border:0px;border-color:white;text-align: center;"></label>
                        </p>
                        <hr />
                        <p style="height:10px;"><label style="width:25%;float: left;border:0px;border-color:white;text-align: left;">image</label>
                            <label id="pt_img" style="width:75%;float: left;border:0px;border-color:white;text-align: center;"></label>
                        </p>
                        <hr />
                        <p style="height:10px;"><label style="width:25%;float: left;border:0px;border-color:white;text-align: left;">Status</label>
                            <label id="StatesText" style="width:75%;float: left;border:0px;border-color:white;text-align: center;"></label>       
                        </p>
                        <hr />
                        <p style="height:10px;"><label style="width:25%;float: left;border:0px;border-color:white;text-align: center;">Download</label>
                            <a id="DownloadText" style="width:75%;float: left;border:0px;border-color:white;text-align: center;">data.rar</a>          
                        </p>
                        <hr />
                        <p><label style="width:25%;float: left;border:0px;border-color:white;text-align: center;">Location</label> 
                            <textarea id="LocationText" rows="2" cols="20" style="width:75%;float: left;border:0px;border-color:white;text-align: center;"></textarea>         
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div id="gpsexpand" class="modal" tabindex="-1"  style="width:360px;z-index:999;position:fixed; display: none;top: 330px;left:390px;opacity: 1;margin-left: -379px;margin-top: -273.5px">
            <div class="modal-header">
                <button id="CloseGPS" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">GPS Search</h4>
            </div>
            
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6" style="width: 100%;font-size:smaller;">
                        <p><input id="sitetext" style="border-radius: 20px;" class="form-control" type="text"/>
                            <img id="Search_GPS_PTSearch" src="image/icon_search.png" width="20" style="z-index: 999;position: absolute;top: 2%;left: 87%;"/>
                        <hr /> 
                        </p>
                                            
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Project</label>
                            <select id="search_gps_projectselect" class="form-control" style="width:80%;" multiple="multiple"></select>
                        </p>
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Province</label>
                            <select id="search_gps_provinceselect" class="form-control" style="width:80%;height:35px;" multiple="multiple">
                                <optgroup label="Province">
                                    <option id="gps_provinceselect_all" value="选择全部">选择全部</option>
                                    <option value="北京市">北京市</option>
                                    <option value="上海市">上海市</option>
                                    <option value="天津市">天津市</option>
                                    <option value="重庆市">重庆市</option>
                                    <option value="黑龙江省">黑龙江省</option>
                                    <option value="吉林省">吉林省</option>
                                    <option value="辽宁省">辽宁省</option>
                                    <option value="内蒙古自治区">内蒙古自治区</option>
                                    <option value="河北省">河北省</option>
                                    <option value="新疆自治区">新疆自治区</option>
                                    <option value="甘肃省">甘肃省</option>
                                    <option value="青海省">青海省</option>
                                    <option value="陕西省">陕西省</option>
                                    <option value="宁夏自治区">宁夏自治区</option>
                                    <option value="河南省">河南省</option>
                                    <option value="山东省">山东省</option>
                                    <option value="山西省">山西省</option>
                                    <option value="安徽省">安徽省</option>
                                    <option value="湖北省">湖北省</option>
                                    <option value="湖南省">湖南省</option>
                                    <option value="江苏省">江苏省</option>
                                    <option value="四川省">四川省</option>
                                    <option value="贵州省">贵州省</option>
                                    <option value="云南省">云南省</option>
                                    <option value="广西省">广西省</option>
                                    <option value="西藏自治区">西藏自治区</option>
                                    <option value="浙江省">浙江省</option>
                                    <option value="江西省">江西省</option>
                                    <option value="广东省">广东省</option>
                                    <option value="福建省">福建省</option>
                                    <option value="台湾省">台湾省</option>
                                    <option value="海南省">海南省</option>
                                    <option value="香港">香港</option>
                                    <option value="澳门">澳门</option>
                                </optgroup>
                            </select>
                        </p>
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Mode</label>
                            <select id="search_gps_modeselect" class="form-control" style="width:80%;">
                                <option>All</option>
                                <option>campain</option>
                                <option selected="selected">continuous</option>
                            </select>
                        </p>
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Style</label>
                            <select id="search_gps_styleselect" class="form-control" style="width:80%;">
                                <option selected="selected">point</option>
                                <option>velocity</option>
                            </select>         
                        </p> 
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Date</label>          
                            <input type="text" id="date" class="form-control" style="width: 80%;" placeholder="Please choose date..." />
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="Search_GPS_CloseBt" type="button" data-dismiss="modal" class="btn btn-default">Close</button>
                <button id="Search_GPS_Search" type="button" class="btn btn-primary">Search</button>
            </div>
        </div>

        <div id="pt_img_show" style="display:none;text-align:center;position: fixed;bottom:30%;right:18%;z-index:99;height:60%;width:40%;background:rgba(255, 255, 255, 0.66);">
            <input type="image" id="imgsrc" style="width: 100%;" />        
        </div>

        <%--Layers菜单的设置--%>
        <div id="firstpane" class="menu_list" style="display:none; z-index:999;position:fixed;top:60px;left:15px;">
            <h3 class="menu_head current">GPS</h3>
	        <div style="display:none" class="menu_body">
                <div style="width:100%;height:400px;">
                    <ul id="treeDemoinput" class="ztree" style="height:100%;width:100%;"></ul> 
                </div>
	        </div>
	
	        <h3 class="menu_head">InSAR</h3>
	        <div style="display:none" class="menu_body">
                <div style="width:100%;height:400px;">
                    <ul id="treeDemoInSAR" class="ztree" style="height:100%;width:100%;"></ul>
                </div>
	        </div>
	
	        <h3 class="menu_head">Other</h3>
	        <div style="display:none" class="menu_body">
                <div style="width:100%;height:400px;">
                    <ul id="treeDemoOther" class="ztree" style="height:100%;width:100%;"></ul> 
                </div>
	        </div>

            <input type="file" id="dataimport" style="margin-top: 2px;display:none;" onchange="setBlogrollImageName();" /> 
            <h3 class="menu_head" id=""  style="background:white;" onclick="selectFile();">Import</h3>
            <h3 class="menu_head" id="Layers_Clear" style="background:white;">Clear</h3>
            <h3 class="menu_head" id="Layers_Close" style="background:white;">Close</h3>
	        <div style="display:none" class="menu_body">
	        </div>
        </div>
    
        <div id="Edit_GPS" class="modal" tabindex="-1"  style="overflow:scroll;width:35%;min-width:300px; z-index:999;position:absolute; display: none;top: 10%;left:30%; opacity: 1;margin-left: 0;margin-top: 0">
            <div class="modal-header">
                <button id="Edit_GPS_CloseBt" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Edit Information</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6" >
                        <p>
                            <label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">sitename</label>
                            <input id="edit_gps_site" style="width:80%;" class="form-control" type="text" />
                        </p>
                        <p>
                            <label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">project</label>
                            <select id="edit_gps_projectselect" class="form-control" style="width:80%;">
                                <option selected="selected">All</option>
                            </select>
                        </p>
                        <p>
                            <label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">province</label>
                            <input id="edit_gps_province" style="width:80%;" class="form-control" type="text" />
                        </p>         
                        <p>
                            <label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">ptname</label>
                            <input id="edit_gps_ptname" style="width:80%;" class="form-control" type="text" />
                        </p>
                        <p>
                            <label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">longitude</label>
                            <input id="edit_gps_lon" style="width:80%;" class="form-control" type="text" />
                        </p>
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">latitude</label><input id="edit_gps_lat" style="width:80%;" class="form-control" type="text" /></p>
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Height</label><input id="edit_gps_H" style="width:80%;" class="form-control" type="text" /></p>
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Ve</label><input id="edit_gps_Ve" style="width:80%;" class="form-control" type="text" /></p>
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Vn</label><input id="edit_gps_Vn" style="width:80%;" class="form-control" type="text" /></p>
                        <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">Vu</label><input id="edit_gps_Vu" style="width:80%;" class="form-control" type="text" /></p>
                    </div>
      <div class="col-md-6">
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">mode</label>              
              <select id="edit_gps_mode" class="form-control" style="width:80%;">
                  <option selected="selected">流动站</option>
                  <option>连续站</option>
              </select>
          </p>          
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">date</label>
              <input type="text" id="editgpsdate" class="form-control" style="width: 80%;" value="2019-09-03" placeholder="Please choose date..." />
          </p>
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">location</label><input id="edit_gps_location" style="width:80%;" class="form-control" type="text" /></p>
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">area</label><input id="edit_gps_area" style="width:80%;" class="form-control" type="text" /></p>
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">host_unit</label><input id="edit_gps_host_unit" style="width:80%;" class="form-control" type="text" /></p>
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">remarks</label><input id="edit_gps_remarks" style="width:80%;" class="form-control" type="text" /></p>
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">status</label>
              <select id="edit_gps_status" class="form-control" style="width:80%;">
                  <option selected="selected">Working</option>
                  <option>N/A</option>
              </select>
          </p>
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">img_url</label><input id="edit_gps_img_url" style="width:80%;" class="form-control" type="text" /></p>
          <p><label style="width:20%;float: left;border:0px;border-color:white;text-align: center;">projectid</label><input id="edit_gps_projectid" style="width:80%;" class="form-control" type="text" /></p>
      </div>
    </div>
            </div>
            <div class="modal-footer">
                <button id="Edit_GPS_Close" type="button" data-dismiss="modal" class="btn btn-default">Close</button>
                <button id="Edit_GPS_Search" type="button" class="btn btn-primary">Search</button>
                <button id="Edit_GPS_Save" type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
        
        

         <div id="Edit_Colorbar" class="modal" tabindex="-1"  style="width:250px;z-index:999;position:fixed; display: none;top: 50%;opacity: 1;margin-left: -379px;margin-top: -273.5px">
             <div class="modal-header">
                 <button id="Edit_Colorbar_CloseBt" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                 <h4 class="modal-title">Set Percent Value</h4>
             </div>
             <div class="modal-body">
                <div class="row">
                    <div class="col-md-6" style="width: 100%;margin-left:10%;">                                           
                        <input id="edit_colorbar_percentval" style="width:80%;" class="form-control" type="text" value="0.95" />
                    </div>
                </div>
            </div>
             <div class="modal-footer">
                 <button id="Edit_Colorbar_Close" type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>
                 <button id="Edit_Colorbar_Finish" type="button" class="btn btn-primary">OK</button>
             </div>
         </div>

    <div class="logoContainer">
         <input type="text" id="logotext" style= "background-color:transparent;border:0px;text-align:center;" value="形变监测成果展示系统" />
    </div>
    <%--图例--%>
     <div id="legendContainer">
        <svg id="legendSVG" height="70%" width="100%" style="font-size: 17px;">
            <circle fill="rgb(0,0,255)" cx="30" cy="25" r="5" style="stroke: rgb(0,0,255);"></circle>
            <text class="legendText" x="85" y="25">CONT</text>
            <rect fill="rgb(190,0,0)" x="25" y="40" width="10" height="10" style="stroke: rgb(190,0,0);"></rect>
            <text class="legendText" x="85" y="45">CAMP</text>
            <line x1="10" y1="65" x2="55" y2="65" style="stroke: rgb(179,29,9);"></line>
            <line x1="45" y1="60" x2="55" y2="65" style="stroke: rgb(179,29,9);"></line>
            <line x1="45" y1="70" x2="55" y2="65" style="stroke: rgb(179,29,9);"></line>          
            <text class="legendText" x="85" y="65" id="v_zoom">30mm/yr</text>  
            <text class="legendText" x="45" y="92">LOS(mm/yr)</text>          
        </svg>
        <input type="text" id="colorbar_min" style="width: 30px;height:22px;font-size:18px;text-align:center;border: 0;background-color: transparent;" value="-8"/>
        <img id="Edit_Colorbar_Logo" style="width: 56%;height: 15%;margin-top:-5%;" src="image/jet_scale_row.png"/>
        <input type="text" id="colorbar_max" style="width: 30px;height: 18px;font-size:18px;text-align:center;border: 0;background-color: transparent;margin-top: -5%;" value="8"/>   
        <div id="mouse-position" style="color:black;font-size:15px;text-align:center;margin-top: -5px;"></div>
    </div>   
   </div>

    <script type="text/javascript">
         $(function () {
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: encodeURI("/Handler.ashx"),
                data: { action: "getInSAR_Project" },
                success: function (mes) {
                    var json = eval(mes);
                    var str = '<optgroup label="Project"><option value="选择全部">选择全部</option>';
                    for (var i = 1; i < json.length; i++) {
                        str += '<option value="' + json[i].name + '">' + json[i].name + '</option>';
                    }
                    str += '</optgroup>';
                    document.getElementById('iproject').innerHTML = str;
                    $('#iproject').fSelect();
                }
            });
        });
        //GPS的选择栏的select初始化
        $(function () {
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: encodeURI("/Handler.ashx"),
                data: { action: "getGPS_Project" },
                success: function (mes) {
                    var json = eval(mes);
                    var str = '<optgroup label="Project"><option value="选择全部">选择全部</option>';
                    for (var i = 1; i < json.length; i++) {
                        str += '<option value="' + json[i].name + '">' + json[i].name + '</option>';
                    }
                    str += '</optgroup>';
                    document.getElementById('search_gps_projectselect').innerHTML = str;
                    $('#search_gps_projectselect').fSelect();
                }
            });
        });
        $('#search_gps_provinceselect').fSelect();
        
        /*这是layer菜单下拉的*/
        $("#firstpane .menu_body:eq(0)").show();
        $("#firstpane h3.menu_head").click(function () {
            $(this).addClass("current").next("div.menu_body").slideToggle(300).siblings("div.menu_body").slideUp("slow");
            $(this).siblings().removeClass("current");
        });
    </script>

    <script type="text/javascript">
        function setCookie(cname, cvalue, exdays) {
            /*****利用全局变量的特性，设置cookie，将登陆的用户名提交到系统上存储*****/
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + "; " + expires;
        };
        function delAllCookie() {
            var myDate = new Date();
            myDate.setTime(-1000);//设置时间    
            var data = document.cookie;
            var dataArray = data.split("; ");
            for (var i = 0; i < dataArray.length; i++) {
                var varName = dataArray[i].split("=");
                document.cookie = varName[0] + "=''; expires=" + myDate.toGMTString();
            }
        };
        function Loginmess(json) {
            /*****Ajax请求成功后执行的函数，通过判断json字符集的长度验证是否成功登陆*****/
            if (json.length == 0) {
                alert("该用户名或密码错误请重新输入！");
            }
            else {
                alert("登陆成功！");
                delAllCookie();//删除所有cookie变量，保证只有一个管理员登陆，以防出现cookie的信息提取错误 
                var name = document.getElementById('username').value;
                setCookie("name", name, 1);
                
                $('#loginmodal').fadeOut();
                //window.location.reload(true);
            }
        };
        function Verify(name, password) {
            /*****Login按钮点击时调用的函数，通过Ajax请求后台数据库，验证服务器中该信息是否存在******/
            var urlStr = encodeURI("/DataRun.ashx");
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: urlStr,
                /******name：用户名；password：密码 ******/
                data: { action: "Verifylogin", name: name, password: password },
                success: function (mes) {
                    var json = eval(mes);
                    Loginmess(json);
                }
            });
        };

        function LoginCookie(json, level, mark) {
            //json.length == 0代表还没有登录，1代表登陆了
            /*level：0代表跳转到数据管理页；1代表跳转到管理员管理页 
            level=0代表是普通管理员，因此只能有数据管理权限
            level=1代表的是系统管理员，具有数据管理和用户管理的权限
            */
            /*mark：0代表数据管理和用户管理的认证；1代表初始化页面是否登录了的认证*/
            if (0 == mark) {
                if (0 == level) {
                    if (json.length == 0) {
                        alert("你还不是管理员，没有访问权限，请登录！");
                    }
                    else {

                        //进行jquery请求数据库的GPS项目数据
                        $.ajax({
                            contentType: "application/json;charset:utf-8",
                            url: encodeURI("/Handler.ashx"),
                            data: { action: "getGPS_Project" },
                            success: function (mes) {
                                var json = eval(mes);
                                for (var i = 1; i < json.length; i++) {
                                    $("#edit_gps_projectselect").append("<option>" + json[i].name + "</option>");
                                }
                            }
                        });
                        $("#Edit_GPS").fadeIn("slow");
                    }
                }
            }
            if (1 == mark) {
                if (json.length == 0) {
                    document.getElementById('login').innerHTML = 'Login';
                }
                else {
                    document.getElementById('login').innerHTML = 'Logout';
                }
            }
        };

        function VerifyCookie(name, level, mark) {
            /*name：用户名；level：0代表管理员的检验；1代表系统管理员的检验 */
            var urlStr = encodeURI("/DataRun.ashx");
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: urlStr,
                data: { action: "VerifyCookie", name: name, level: level },
                success: function (mes) {
                    var json = eval(mes);
                    LoginCookie(json, level, mark);
                    console.log(json);
                }
            });
        };

        $("#login").init(function () {
            var name = document.cookie.split(';')[0].split('=')[1];
            var flag = 1;
            var mark = 1;
            VerifyCookie(name, flag, mark);
            VerifyCookie(name, 0, mark);
        });

        $(function () {
            $('#loginbtn').click(function (e) {
                var name = $('#username').val();
                var pwd = $('#password').val();
                if (name == "") {
                    alert("请输入用户名！");
                }
                if (pwd == "") {
                    alert("请输入密码！");
                }
                else {
                    Verify(name, pwd);
                }
                //console.log(0);
                document.getElementById('login').innerHTML = "Logout";
            });
        });

        $('#login').click(function (e) {
            var logval = $('#login').text();
            if ("Login" == logval) {
                $('#loginmodal').fadeIn();
            }
            if ("Logout" == logval) {
                delAllCookie();//删除所有cookie变量
                alert("你已退出登录！");
                window.location.reload();
            }
        });
        $('#Close_Login').click(function () {
            $('#loginmodal').fadeOut();
        });


</script>

    <%--<script src="http://www.jq22.com/js/jq.js"></script>--%>
    <script type="text/javascript">
        /******************全局变量************************/
        //=================================================

        var vectorLayer;//第一个图层变量
        var VLayers = new Array();
        var checkidarr = "";//树节点的id

        //全局变量，定义项目目录的勾选的id的数组
        var projectset = new Array();//js数组排序是从小到大排序

        var projectk = 0;
        //***点数据请求的全局变量
        var json;
        var json_polygon;//insar的多边形边框
        var json_pcl = [];//insar的点云
        var json_chart_total;//insar的时间序列图,累加量,(要删除)
        var json_chart_add;//insar的时间序列图,增量(要删除)
        var json_pt;//gps点       
        var json_json_v_std;

        //InSAR点按放大缩小级数获取的json数组
        var json_zoom0 = [];//零级：zoom>16,num=0,
        var json_zoom1 = [];//一级：15.5<zoom<=16,num=2
        var json_zoom2 = [];//二级：15<zoom<=15.5,num=3
        var json_zoom3 = [];//三级：14<zoom<=15,num=5
        var json_zoom4 = [];//四级：13<zoom<=14,num=10
        var json_zoom5 = [];//五级：12<zoom<=13,num=15
        var json_zoom6 = [];//六级：11<zoom<=12,num=20

        var json_zoom7 = [];//七级：10<zoom<=11,num=25
        var json_zoom8 = [];//八级：9<zoom<=10,num=30
        var json_zoom9 = [];//九级：8<zoom<=9,num=35

        //zoom小于8，就显示几何框
        var json_zoom = [];//用于传递的json_zoom数组

        //js在局部函数中定义成全局变量的方式：
        //第一种，不对该变量进行var声明，则默认是全局变量，不推荐，容易出错,eg:k=2;
        //第二种，通过window.变量名方式进行声明,eg:window.k=2;
        //动态创建全局变量
        var Vars_InSARKML = {};//InSAR数据的KML图层的全局变量
        var Vars_InSARPCL = {};//InSAR数据的点云图层的全局变量
        var Vars_Other = {};//Other数据图层的全局变量

        //=================================================
        /******************全局变量************************/
        //定义insar数据的浮云窗
        var container = document.getElementById('InSAR_popup');
        var InSAR_content = document.getElementById('popup-content');
        var closer = document.getElementById('popup-closer');
        var InSAR_overlay = new ol.Overlay({
            element: container,
            autoPan: true,
            autoPanAnimation: {
                duration: 250
            }
        });
        closer.onclick = function () {
            InSAR_overlay.setPosition(undefined);
            closer.blur();
            return false;
        };

        /***********定义数据文件类型*********************************/
        var dragAndDropInteraction = new ol.interaction.DragAndDrop({
            //定义：拖动到地图添加显示GPX,GeoJSON,IGC,KML,TopoJSON文件数据
            formatConstructors: [
                ol.format.GPX,
                ol.format.GeoJSON,
                ol.format.IGC,
                ol.format.KML,
                ol.format.TopoJSON
            ]
        });
        /***********定义数据文件类型*********************************/

        //定义加载的底图图层   
        var BingMapLayer = new ol.layer.Tile({//定义Bing地图图层
            title: "BingMap",
            type: 'base',
            baseLayer: true,
            source: new ol.source.BingMaps({
                imagerySet: 'Aerial',
                key: 'Pgj9mAB0Px05qDiOXT67~Xa8bjeVI7aHyDvGstUgyGg~AiUWfTJO-ksOE_1RiOy7P4_PxURXNek7aEFR8mr8n_Ue0H2iZZduaVyMgfxOUc2m',
                attributions: ['Tectonic Geodesy@GDUT   <a href="https://earhw.github.io">联系我们</a>']
            }),
            visible: false
        });

        var GoogleTerrainLayer = new ol.layer.Tile({//定义Google地形图图层
            title: "GoogleTerrain",
            type: 'base',
            source: new ol.source.XYZ({
                url: 'http://mt3.google.cn/vt/lyrs=t@131,r@216000000&hl=zh-CN&gl=CN&src=app&x={x}&y={y}&z={z}&s=Gal',//谷歌地形地图
                attributions: ['Tectonic Geodesy@GDUT   <a href="https://earhw.github.io">联系我们</a>'],
            }),
            projection: 'EPSG:3857',        
        });
 
        var GoogleMapLayer = new ol.layer.Tile({//定义Google普通地图图层，没调用
            title: "GoogleMap",
            type: 'base',
            baseLayer: true,
            source: new ol.source.XYZ({
                url: 'http://www.google.cn/maps/vt/pb=!1m4!1m3!1i{z}!2i{x}!3i{y}!2m3!1e0!2sm!3i380072576!3m8!2szh-CN!3scn!5e1105!12m4!1e68!2m2!1sset!2sRoadmap!4e0!5m1!1e0',
                attributions: ['Tectonic Geodesy@GDUT   <a href="https://earhw.github.io">联系我们</a>']
            }),
            visible: false
        });

        var OpenCycleMapLayer = new ol.layer.Tile({//定义OpenCycle普通地图图层
            title: "OpenCycleMap",
            type: 'base',
            baseLayer: true,
            source: new ol.source.XYZ({
                url: 'https://{a-c}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png' + '?apikey=82f12242d9a44a22967596f292f3f046',                
                attributions: ['Tectonic Geodesy@GDUT   <a href="https://earhw.github.io">联系我们</a>']
            }),
            visible: false
        });

        //定义地图
        var map = new ol.Map({
            target: 'map',
            layers: [//定义图层
                OpenCycleMapLayer,
                GoogleTerrainLayer,
                BingMapLayer
            ],
            overlays: [InSAR_overlay],
            view: new ol.View({//定义视图
                center: ol.proj.fromLonLat([100, 34]),
                zoom: 4
            }),
            interactions: ol.interaction.defaults().extend([dragAndDropInteraction]),//拖拽加载各类文件数据
            controls: ol.control.defaults().extend([//地图基本控件
                new ol.control.OverviewMap(),//鹰眼
                new ol.control.CanvasScaleLine(),//比例尺
                new ol.control.FullScreen(),//全屏显示
                new ol.control.MousePosition({//鼠标位置设置
                    coordinateFormat: function (coordinate) {
                        return ol.coordinate.format(coordinate, '{x}°E {y}°N', 2);
                    },
                    projection: 'EPSG:4326',
                    className: 'custom-mouse-position',
                    target: document.getElementById('mouse-position'),
                    undefinedHTML: '&nbsp'
                })
            ]),
        });

        /*
        *******************************GPS模块*******************************
        */
        //定义GPS数据图层的全局变量
        var vectorLayer_GPS = new ol.layer.Vector({
            source: new ol.source.Vector({
                features: []
            })
        });

        //定义GPS文字注释图层的全局变量
        var vectorLayer_Label = new ol.layer.Vector({
            source: new ol.source.Vector({
                features: []
            })
        });
        var GPS_style = "point";
        //设置GPS点要素图层的注释文字样式
        function Style_Label(feature, mode) {
            var color_fill, color_out;
            if ("连续站" == mode) {
                color_fill = '#0000FF';
                color_out = '#0080FF';
            }
            if ("流动站" == mode) {
                color_fill = '#B40404';
                color_out = '#FF4000';
            }

            return new ol.style.Style({
                text: new ol.style.Text({
                    textAlign: 'left',            //位置
                    textBaseline: 'middle',         //基准线
                    offsetY: '5',
                    offsetX: '6',
                    font: 'normal 14px 微软雅黑',    //文字样式
                    text: feature.get('name'),      //文本内容
                    fill: new ol.style.Fill({       //文本填充样式（即文字颜色)
                        color: color_fill
                    }),
                    stroke: new ol.style.Stroke({
                        color: color_out,
                        width: 2
                    })
                })
            });
        };

        //设置GPS点数据显示样式
        function Style_Point(feature, mode) {         
            var img_pt;
            //判断点的观测模式
            if ("连续站" == mode) {
                img_pt = new ol.style.Circle({
                    radius: 3,
                    fill: new ol.style.Fill({
                        color: 'rgb(0,0,255)'
                    }),
                    stroke: new ol.style.Stroke({ color: 'rgb(0,0,255)', width: 1 })
                })
            }
            else if ("流动站" == mode) {
                img_pt = new ol.style.Icon({
                    src: 'image/rat.jpg',
                    anchor: [0.5, 0.5],
                    rotateWithView: true,
                    scale: '1.5'
                });
            }
            //返回GPS数据点显示样式
            return new ol.style.Style({
                image: img_pt
            });
        };

        //设置GPS速度数据显示样式
        function Style_Velocity(feature) {
            var geometry = feature.getGeometry();
            var styles = [
            new ol.style.Style({ // 线串的样式
                stroke: new ol.style.Stroke({
                    color: 'rgb(190,0,0)',
                    width: 2
                })
            })
            ];
            // 对线段的每一个子线段都设置箭头样式
            geometry.forEachSegment(function (start, end) {
                var dx = end[0] - start[0];
                var dy = end[1] - start[1];
                var rotation = Math.atan2(dy, dx);
                styles.push(new ol.style.Style({
                    geometry: new ol.geom.Point(end),
                    image: new ol.style.Icon({
                        src: 'image/Rarrow.png',
                        scale: '0.4',
                        anchor: [0.75, 0.5],
                        rotateWithView: true,
                        rotation: -rotation
                    })
                }));
            });
            return styles;
        };

        //设置GPS数据的加载
        function Show_GPS(json, mode, DataLayer, LabelLayer) {
            //点要素加载
            if (mode == "point") {
                for (var i = 0; i < json.length; i++) {
                    if (parseFloat(json[i].lon) != null) {
                        //定义文字注释并添加到注释图层
                        var iconFeature = new ol.Feature({
                            geometry: new ol.geom.Point(ol.proj.fromLonLat([parseFloat(json[i].lon), parseFloat(json[i].lat)])),
                            name: json[i].name //名称属性
                        });

                        iconFeature.setStyle(Style_Label(iconFeature, json[i].siteproperty));
                        LabelLayer.getSource().addFeature(iconFeature);

                        //定义点要素并添加到数据图层
                        var ptFeature = new ol.Feature({//ptFeature:PointFeature
                            geometry: new ol.geom.Point(ol.proj.fromLonLat([parseFloat(json[i].lon), parseFloat(json[i].lat)])),
                            name: json[i].name, //名称属性
                            GPS_style:"point"
                        });

                        ptFeature.setStyle(Style_Point(ptFeature, json[i].siteproperty));
                        DataLayer.getSource().addFeature(ptFeature);                       
                    }
                }
                //添加注释图层到地图并隐藏
                map.addLayer(LabelLayer);
                LabelLayer.setVisible(false);
            }
            else {//速度加载
                for (var i = 0; i < json.length; i++) {
                    if ((parseFloat(json[i].lon) != parseFloat(json[i].lonend)) | (parseFloat(json[i].lat) != parseFloat(json[i].latend))) {
                        //定义某一段线段的首末点坐标
                        var strPrj1 = ol.proj.transform([parseFloat(json[i].lon), parseFloat(json[i].lat)], 'EPSG:4326', 'EPSG:3857');
                        var strPrj2 = ol.proj.transform([parseFloat(json[i].lonend), parseFloat(json[i].latend)], 'EPSG:4326', 'EPSG:3857');
                        //由首末坐标定义线段
                        var Line_V = new ol.geom.LineString([strPrj1, strPrj2]);

                        //定义线要素并添加到数据图层
                        var lsFeature = new ol.Feature({//lsFeature:LineSegmentFeature
                            geometry: Line_V,
                            name: json[i].name,  //名称属性   
                            GPS_style:"velocity"
                        });

                        lsFeature.setStyle(Style_Velocity(lsFeature));
                        DataLayer.getSource().addFeature(lsFeature);
                    }
                }
            }
            //添加数据图层到地图并按最适合的比例缩放到合适位置
            map.addLayer(DataLayer);

            if (json.length == 1) {
                //设置图层放大比例为10
                map.getView().setZoom(8);
                //设置显示的点为中心点
                map.getView().setCenter(ol.proj.transform([parseFloat(json[0].lon), parseFloat(json[0].lat)], 'EPSG:4326', 'EPSG:3857'));
            } else {
                map.getView().fit(DataLayer.getSource().getExtent());
            }
            
        };

        //设置数据图层的元素清空和图层移除
        function ClearLayer(Layer, para) {
            //para为标记参数，如果para=true,则移除图层
            //para=false则只是删除元素，不移除图层
            var f = Layer.getSource().getFeatures();
            for (var i = 0; i < f.length; i++) {
                Layer.getSource().removeFeature(f[i]);
            }
            if (para==true) {
                map.removeLayer(Layer);
            }
            
        };

        //设置Layers菜单下的GPS的目录树数组
        var SettingLyGPS = {           
            check: {
                enable: true,
                nocheckInherit: true
            },
            async: {
                enable: true,
                url: "",
                dataFilter: filter
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {

                onCheck: LyGPSCheck,
                beforeClick: function (treeId, treeNode) {
                    var zTree = $.fn.zTree.getZTreeObj("treeDemoinput");
                    if (treeNode.isParent) {
                        zTree.expandNode(treeNode);
                        return false;
                    } else {
                        for (var i = 0; i < json_pt.length; i++) {
                            if (treeNode.name == json_pt[i].name) {
                                GPS_Show_Popup(json_pt, i);

                                //设置图层放大比例为10
                                map.getView().setZoom(10);
                                //设置显示的点为中心点
                                map.getView().setCenter(ol.proj.transform([parseFloat(json_pt[i].lon), parseFloat(json_pt[i].lat)], 'EPSG:4326', 'EPSG:3857'));
                                //添加波动的动画
                                var p = ol.proj.fromLonLat([parseFloat(json_pt[i].lon), parseFloat(json_pt[i].lat)]);
                                pulse(p);
                            }
                        }
                        return true;
                    }
                },
            }
        };

        function filter(treeId, parentNode, childNodes) {
            if (!childNodes) return null;
            for (var i = 0, l = childNodes.length; i < l; i++) {
                childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');
            }
            return childNodes;
        };

        //设置勾选Layers菜单下的GPS目录树时的动画
        //定义脉冲动画
        function pulseFeature(coordinate) {
            var f = new ol.Feature(new ol.geom.Point(coordinate));
            f.setStyle(new ol.style.Style(
                        {
                            image: new ol.style['Circle'](
                            {
                                radius: 30,
                                points: 4,
                                stroke: new ol.style.Stroke({ color: 'red', width: 2 })
                            })
                        }));
            map.animateFeature(f, new ol.featureAnimation.Zoom(
                {
                    fade: ol.easing.easeOut,
                    duration: 3000,
                    easing: ol.easing['upAndDown']
                }));
        };

        function pulse(lonlat)//坐标为经纬度
        {
            var nb = 'upAndDown' == '5' ? 1 : 3;
            for (var i = 0; i < nb; i++) {
                setTimeout(function () {
                    pulseFeature(lonlat);
                }, i * 500);
            };
        };
        //GPS的浮云窗显示，主要用于点位信息的显示
        function GPS_Show_Popup(json, n) {
            document.getElementById('siteText').innerHTML = json[n].name;
            document.getElementById('StatesText').innerHTML = json[n].working;
            document.getElementById('LocationText').value = json[n].location;
            

            var L = parseFloat(json[n].lon).toFixed(2).toString();
            var B = parseFloat(json[n].lat).toFixed(2).toString();
            var H = parseFloat(json[n].H).toFixed(2).toString();
            var vE = parseFloat(json[n].vE).toFixed(2).toString();
            var vN = parseFloat(json[n].vN).toFixed(2).toString();
            var vU = 0;

            document.getElementById('BLHText').innerHTML = B + " , " + L + " , " + H ;
            document.getElementById('vENUText').innerHTML = vE + " , " + vN + " , " + vU;

            if (json[n].img == "N/A") {
                document.getElementById('pt_img').innerHTML = 'N/A';
                document.getElementById('imgsrc').src = "";
                //下载链接
                document.getElementById('DownloadText').innerHTML = 'N/A';
                document.getElementById('DownloadText').href = "#";

            } else {
                document.getElementById('pt_img').innerHTML = '<img src="image/img.jpg" width="20" />';
                document.getElementById('imgsrc').src = json[n].img;
                //下载链接
                document.getElementById('DownloadText').innerHTML = 'data.rar';

                var url = json[n].img.split('/');
                document.getElementById('DownloadText').href = url[0] + '/' + url[1] + '/datalink/' + url[2].split('.')[0] + '.rar'
             // document.getElementById('DownloadText').href = json[n].img.split('.')[0] + ".rar";
            }



            $("#gpspopup").show();
        }

        //勾选复选框出现脉冲和点位信息的显示框
        function LyGPSCheck(e, treeId, treeNode) {
            var zTree = $.fn.zTree.getZTreeObj("treeDemoinput");
            if (treeNode.isParent == true) {
                if (treeNode.checked == true) {
                    //设置图层放大比例为4，这是为速度箭头的显示做准备的
                    map.getView().setZoom(4);
                    //重新加载数据
                    Show_GPS(json_pt, GPS_style, vectorLayer_GPS, vectorLayer_Label);
                } else {
                    if (GPS_style == "point") {
                        ClearLayer(vectorLayer_GPS,true);
                        ClearLayer(vectorLayer_Label, true);
                    } else if (GPS_style == "velocity") {
                        ClearLayer(vectorLayer_GPS, true);
                    }
                }
            }
            else {
                if (treeNode.checked == false) {
                    var f = vectorLayer_GPS.getSource().getFeatures();
                    
                    for (var i = 0; i < f.length; i++) {
                        if (treeNode.name == f[i].values_.name) {
                            var p = f[i].values_.geometry.flatCoordinates;
                            pulse(p);
                            vectorLayer_GPS.getSource().removeFeature(f[i]);

                            if (GPS_style == "point") {
                                var g = vectorLayer_Label.getSource().getFeatures();
                                vectorLayer_Label.getSource().removeFeature(g[i]);
                            }

                            break;
                        }
                    }
                    $("#gpspopup").hide();
                }
                else {
                    for (var i = 0; i < json_pt.length; i++) {

                        if (treeNode.name == json_pt[i].name) {
                            if(GPS_style == "point"){
                            var iconFeature = new ol.Feature({
                                geometry: new ol.geom.Point(ol.proj.fromLonLat([parseFloat(json_pt[i].lon), parseFloat(json_pt[i].lat)])),
                                name: json_pt[i].name //名称属性
                            });
                            var ptFeature = new ol.Feature({
                                geometry: new ol.geom.Point(ol.proj.fromLonLat([parseFloat(json_pt[i].lon), parseFloat(json_pt[i].lat)])),
                                name: json_pt[i].name //名称属性
                            });
                            ptFeature.setStyle(Style_Point(ptFeature, json_pt[i].siteproperty));
                            vectorLayer_GPS.getSource().addFeature(ptFeature);

                            iconFeature.setStyle(Style_Label(iconFeature, json_pt[i].siteproperty));
                            vectorLayer_Label.getSource().addFeature(iconFeature);
                            map.getView().setCenter(ol.proj.transform([parseFloat(json_pt[i].lon), parseFloat(json_pt[i].lat)], 'EPSG:4326', 'EPSG:3857'));

                            } else if (GPS_style == "velocity") {
                                
                                //定义某一段线段的首末点坐标
                                if ((parseFloat(json_pt[i].lon) != parseFloat(json_pt[i].lonend)) | (parseFloat(json_pt[i].lat) != parseFloat(json_pt[i].latend))) {
                                    //设置图层放大比例为4，这是为速度箭头的显示做准备的
                                    map.getView().setZoom(4);

                                    var strPrj1 = ol.proj.transform([parseFloat(json_pt[i].lon), parseFloat(json_pt[i].lat)], 'EPSG:4326', 'EPSG:3857');
                                    var strPrj2 = ol.proj.transform([parseFloat(json_pt[i].lonend), parseFloat(json_pt[i].latend)], 'EPSG:4326', 'EPSG:3857');
                                    //由首末坐标定义线段
                                    var Line_V = new ol.geom.LineString([strPrj1, strPrj2]);

                                    //定义线要素并添加到数据图层
                                    var lsFeature = new ol.Feature({//lsFeature:LineSegmentFeature
                                        geometry: Line_V,
                                        name: json_pt[i].name,  //名称属性   
                                        GPS_style: "velocity"
                                    });

                                    lsFeature.setStyle(Style_Velocity(lsFeature));
                                    vectorLayer_GPS.getSource().addFeature(lsFeature);

                                    map.getView().fit(vectorLayer_GPS.getSource().getExtent());
                                }
                            }
                            
                            var p = ol.proj.fromLonLat([parseFloat(json_pt[i].lon), parseFloat(json_pt[i].lat)]);
                            pulse(p);
                            break;
                        }
                    }
                    //GPS_Show_Popup(json_pt, i);
                }
            }
        };

        //设置初始化Layers菜单的GPS目录
        function InitLyGPS(project, province, mode, date) {
            SettingLyGPS.async.url = "/Handler.ashx?action=getLayers_GPS&project=" + project + "&province=" + province + "&mode=" + mode + "&date=" + date;
            $.fn.zTree.init($("#treeDemoinput"), SettingLyGPS);
        };

        //调用jquery处理GPS的复杂数据查询并显示
        $('#Search_GPS_Search').click(function (item) {

            //清空并移除上次查询加载的数据图层
            ClearLayer(vectorLayer_GPS, true);
            ClearLayer(vectorLayer_Label, true);

            //设置图层放大比例为4，这是为速度箭头的显示做准备的
            map.getView().setZoom(4);

            //获取GPS数据查询的参数
            //step 1:项目和省份的获取
            var project = "";//获取项目名字符串
            var province = "";//获取省份字符串
            var project_val = $('#search_gps_projectselect option:selected');//获取已选项目的数组对象
            var province_val = $('#search_gps_provinceselect option:selected');//获取已选省份的数组对象

            if (project_val.length < 1) {
                alert("请勾选项目！");
            }
            if (province_val.length < 1) {
                alert("请勾选省份！");
            }
            for (var i = 0; i < project_val.length; i++) {
                if (project_val[i].value == "选择全部") { continue; };
                project += project_val[i].value;
                if (i < project_val.length - 1) {
                    project += ",";
                }

            }
            for (var i = 0; i < province_val.length; i++) {
                if (province_val[i].value == "选择全部") { continue; };
                province += province_val[i].value;
                if (i < province_val.length - 1) {
                    province += ",";
                }

            }
            //step 2:其他参数的获取
            var mode = $('#search_gps_modeselect option:selected')[0].value;
            var style = $('#search_gps_styleselect option:selected')[0].value;
            var date = document.getElementById('date').value;
            var scalevalue = (map.getView().getResolution()) * 3779.5275590551;

            //调用jquery在后台进行SQL数据库的请求
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: encodeURI("/Handler.ashx"),
                data: { action: "getGPS_Search_P_V", project: project, province: province, mode: mode, date: date, scalevalue: scalevalue },
                success: function (mes) {
                    json_pt = eval(mes);
                    Show_GPS(json_pt, style, vectorLayer_GPS, vectorLayer_Label);
                }
            });

            //初始化Layers菜单栏的GPS目录树
            InitLyGPS(project, province, mode, date);
            //修改GPS显示样式值（point/velocity），用于Layer层的显示删除
            GPS_style = style;
        });

        //调用jquery进行GPS点位信息的查询
        $('#Edit_GPS_Search').click(function (item) {
            var project = $('#edit_gps_projectselect option:selected').val();
            var sitename = $('#edit_gps_site').val();

            var urlStr = encodeURI("/ChangPage.ashx");
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: urlStr,
                data: { action: "EditGPS_Search", project: project, sitename: sitename },
                success: function (mes) {
                    var json = eval(mes);
                    if (json[0].mess == "fail") {
                        alert(json[0].err);
                    }
                    if (json[0].mess == "success") {
                        $('#edit_gps_province').val(json[0].province);
                        $('#edit_gps_ptname').val(json[0].ptname);
                        $('#edit_gps_lon').val(json[0].lon);
                        $('#edit_gps_lat').val(json[0].lat);
                        $('#edit_gps_H').val(json[0].H);
                        $('#edit_gps_Ve').val(json[0].Ve);
                        $('#edit_gps_Vn').val(json[0].Vn);
                        $('#edit_gps_Vu').val(json[0].Vu);
                        $('#edit_gps_location').val(json[0].location);
                        $('#edit_gps_area').val(json[0].area);
                        $('#edit_gps_host_unit').val(json[0].hostunit);
                        $('#edit_gps_remarks').val(json[0].remarks);
                        $('#edit_gps_img_url').val(json[0].img);
                        $('#edit_gps_projectid').val(json[0].projectid);
                        $("#edit_gps_mode option[text='" + json[0].mode + "']").attr("selected", "selected");
                        $("#edit_gps_status option[text='" + json[0].status + "']").attr("selected", "selected");
                        $('#editgpsdate').val(json[0].date);
                    }
                }
            });
        });

        //调用jquery进行GPS点位信息的保存
        $('#Edit_GPS_Save').click(function (item) {
            var project = $('#edit_gps_projectselect option:selected').val();
            var sitename = $('#edit_gps_site').val();

            if ("" == sitename) {
                alert("please input the sitename！");
            }
            else {
                var province = $('#edit_gps_province').val();
                var ptname = $('#edit_gps_ptname').val();
                var lon = $('#edit_gps_lon').val();
                var lat = $('#edit_gps_lat').val();
                var H = $('#edit_gps_H').val();
                var Ve = $('#edit_gps_Ve').val();
                var Vn = $('#edit_gps_Vn').val();
                var Vu = $('#edit_gps_Vu').val();
                var location = $('#edit_gps_location').val();
                var area = $('#edit_gps_area').val();
                var hostunit = $('#edit_gps_host_unit').val();
                var remarks = $('#edit_gps_remarks').val();
                var img = $('#edit_gps_img_url').val();
                var projectid = $('#edit_gps_projectid').val();
                var mode = $("#edit_gps_mode option:selected").val();
                var status = $("#edit_gps_status option:selected").val();
                var date = $('#editgpsdate').val();

                var urlStr = encodeURI("/ChangPage.ashx");
                $.ajax({
                    contentType: "application/json;charset:utf-8",
                    url: urlStr,
                    data: { action: "EditGPS_Save", project: project, sitename: sitename, province: province, ptname: ptname, lon: lon, lat: lat, H: H, Ve: Ve, Vn: Vn, Vu: Vu, location: location, area: area, hostunit: hostunit, remarks: remarks, img: img, projectid: projectid, mode: mode, status: status, date: date },

                    success: function (mes) {
                        var json = eval(mes);
                        if (json.length > 0) {
                            alert("Save successfully");
                        }
                    }
                });
            }
        });

        //调用jquery处理GPS的单点数据查询并显示
        $('#Search_GPS_PTSearch').click(function () {
            //清空并移除上次查询加载的数据图层
            ClearLayer(vectorLayer_GPS, true);
            ClearLayer(vectorLayer_Label, true);

            var sitetext = document.getElementById('sitetext').value;
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: encodeURI("/Handler.ashx"),
                data: { action: "getGPS_SinglePoint", sitetext: sitetext },
                success: function (mes) {
                    json_pt = eval(mes);
                    Show_GPS(json_pt, "point", vectorLayer_GPS, vectorLayer_Label);
                }
            });
        });



        /*
        *******************************InSAR模块********************************
        */
        //定义InSAR数据图层的全局变量
        var vectorLayer_InSAR = new ol.layer.Vector({
            source: new ol.source.Vector({
                features: []
            })
        });

        //定义InSAR多视加载数据点的全局变量
        var vectorLayer_InSARZoomIn = new ol.layer.Vector({
            source: new ol.source.Vector({
                features: []
            })
        });

        //同时加载到地图
        map.addLayer(vectorLayer_InSARZoomIn);

        //定义InSAR多边形的全局变量
        var vectorLayer_InSAR_Polygon = new ol.layer.Vector({
            source: new ol.source.Vector({
                features: []
            })
        });

        //设置InSAR点云的样式
        function Style_Color(feature, h,r) {
            //彩虹渐变颜色数组
            var jet = ['#000080', '#000084', '#000089', '#00008d', '#000092', '#000096',
                       '#00009b', '#00009f', '#0000a4', '#0000a8', '#0000ad', '#0000b2',
                       '#0000b6', '#0000bb', '#0000bf', '#0000c4', '#0000c8', '#0000cd',
                       '#0000d1', '#0000d6', '#0000da', '#0000df', '#0000e3', '#0000e8',
                       '#0000ed', '#0000f1', '#0000f6', '#0000fa', '#0000ff', '#0000ff',
                       '#0000ff', '#0000ff', '#0000ff', '#0004ff', '#0008ff', '#000cff',
                       '#0010ff', '#0014ff', '#0018ff', '#001cff', '#0020ff', '#0024ff',
                       '#0028ff', '#002cff', '#0030ff', '#0034ff', '#0038ff', '#003cff',
                       '#0040ff', '#0044ff', '#0048ff', '#004cff', '#0050ff', '#0054ff',
                       '#0058ff', '#005cff', '#0060ff', '#0064ff', '#0068ff', '#006cff',
                       '#0070ff', '#0074ff', '#0078ff', '#007cff', '#0080ff', '#0084ff',
                       '#0088ff', '#008cff', '#0090ff', '#0094ff', '#0098ff', '#009cff',
                       '#00a0ff', '#00a4ff', '#00a8ff', '#00acff', '#00b0ff', '#00b4ff',
                       '#00b8ff', '#00bcff', '#00c0ff', '#00c4ff', '#00c8ff', '#00ccff',
                       '#00d0ff', '#00d4ff', '#00d8ff', '#00dcfe', '#00e0fb', '#00e4f8',
                       '#02e8f4', '#06ecf1', '#09f0ee', '#0cf4eb', '#0ff8e7', '#13fce4',
                       '#16ffe1', '#19ffde', '#1cffdb', '#1fffd7', '#23ffd4', '#26ffd1',
                       '#29ffce', '#2cffca', '#30ffc7', '#33ffc4', '#36ffc1', '#39ffbe',
                       '#3cffba', '#40ffb7', '#43ffb4', '#46ffb1', '#49ffad', '#4dffaa',
                       '#50ffa7', '#53ffa4', '#56ffa0', '#5aff9d', '#5dff9a', '#60ff97',
                       '#63ff94', '#66ff90', '#6aff8d', '#6dff8a', '#70ff87', '#73ff83',
                       '#77ff80', '#7aff7d', '#7dff7a', '#80ff77', '#83ff73', '#87ff70',
                       '#8aff6d', '#8dff6a', '#90ff66', '#94ff63', '#97ff60', '#9aff5d',
                       '#9dff5a', '#a0ff56', '#a4ff53', '#a7ff50', '#aaff4d', '#adff49',
                       '#b1ff46', '#b4ff43', '#b7ff40', '#baff3c', '#beff39', '#c1ff36',
                       '#c4ff33', '#c7ff30', '#caff2c', '#ceff29', '#d1ff26', '#d4ff23',
                       '#d7ff1f', '#dbff1c', '#deff19', '#e1ff16', '#e4ff13', '#e7ff0f',
                       '#ebff0c', '#eeff09', '#f1fc06', '#f4f802', '#f8f500', '#fbf100',
                       '#feed00', '#ffea00', '#ffe600', '#ffe200', '#ffde00', '#ffdb00',
                       '#ffd700', '#ffd300', '#ffd000', '#ffcc00', '#ffc800', '#ffc400',
                       '#ffc100', '#ffbd00', '#ffb900', '#ffb600', '#ffb200', '#ffae00',
                       '#ffab00', '#ffa700', '#ffa300', '#ff9f00', '#ff9c00', '#ff9800',
                       '#ff9400', '#ff9100', '#ff8d00', '#ff8900', '#ff8600', '#ff8200',
                       '#ff7e00', '#ff7a00', '#ff7700', '#ff7300', '#ff6f00', '#ff6c00',
                       '#ff6800', '#ff6400', '#ff6000', '#ff5d00', '#ff5900', '#ff5500',
                       '#ff5200', '#ff4e00', '#ff4a00', '#ff4700', '#ff4300', '#ff3f00',
                       '#ff3b00', '#ff3800', '#ff3400', '#ff3000', '#ff2d00', '#ff2900',
                       '#ff2500', '#ff2200', '#ff1e00', '#ff1a00', '#ff1600', '#ff1300',
                       '#fa0f00', '#f60b00', '#f10800', '#ed0400', '#e80000', '#e40000',
                       '#df0000', '#da0000', '#d60000', '#d10000', '#cd0000', '#c80000',
                       '#c40000', '#bf0000', '#bb0000', '#b60000', '#b20000', '#ad0000',
                       '#a80000', '#a40000', '#9f0000', '#9b0000', '#960000', '#920000',
                       '#8d0000', '#890000', '#840000', '#800000'];

            var max = document.getElementById('colorbar_max').value;
            var min = document.getElementById('colorbar_min').value;

            var num = Math.round((2 * h / (max - min) * 128)) + 128;
            if (num > 255) { num = 255; }
            if (num < 0) { num = 0; }

            //返回一个点的样式
            return new ol.style.Style({
                image: new ol.style.Circle({
                    radius: r,//2
                    fill: new ol.style.Fill({
                        color: jet[num]
                    }),
                    stroke: new ol.style.Stroke({ color: jet[num], width: 1 })
                })
            });
        };

        //设置加载InSAR点云数据
        function InSAR_Show_PCL(json, num, width, length, sta_l, Layer) {
            //sta_l:表示从第几行开始加载
            //num：表示每隔几行、几列加载一个点
            //width, length:这一景数据的列数（宽）和行数（行/高）
            ClearLayer(Layer, false);
            //计算最大最小值
            var percent = document.getElementById('edit_colorbar_percentval').value;

            //对json数组进行排序
            var json_sorts = json.filter(function (e) { return e.settle != -10000; });
            var json_sorte = json_sorts.sort(sort_by('settle', true, parseFloat)); //升序排

            //获取最大最小值的json数组的下标
            var n_min = parseInt(json_sorte.length * (1.0 - percent) / 2);
            var n_max = json_sorte.length - parseInt(json_sorte.length * 0.05 / 2);
            //获取最大最小值
            var min = parseFloat(json_sorte[n_min].settle);
            var max = parseFloat(json_sorte[n_max].settle);

            document.getElementById('colorbar_max').value = max.toFixed(1);
            document.getElementById('colorbar_min').value = min.toFixed(1);

            for (var j = sta_l; j < length; j += num) {//行
                for (var i = 0; i < width; i = i + num) {
                    if ((j * width + i) < json.length) {
                        if (json[j * width + i].settle != "-10000") {
                            var iconFeature = new ol.Feature({
                                geometry: new ol.geom.Point(ol.proj.fromLonLat([parseFloat(json[j * width + i].lon), parseFloat(json[j * width + i].lat)])),
                                settle: json[j * width + i].settle
                            });

                            if (parseFloat(json[j * width + i].settle) > max) {
                                iconFeature.setStyle(Style_Color(iconFeature, max,4));
                            } else if (parseFloat(json[j * width + i].settle) > min) {
                                iconFeature.setStyle(Style_Color(iconFeature, json[j * width + i].settle,4));
                            } else {
                                iconFeature.setStyle(Style_Color(iconFeature, min,4));
                            }
                            Layer.getSource().addFeature(iconFeature);
                        }
                    }
                }
            }

            map.addLayer(Layer);
            map.getView().fit(Layer.getSource().getExtent());
        };

        //设置加载InSAR多边形
        function InSAR_Show_Polygon(json, Layer) {
            for (var i = 0; i < json.length; i += 4) {
                if (parseFloat(json[i].lon) != null) {
                    var pt1, pt2, pt3, pt4;
                    pt1 = ol.proj.fromLonLat([parseFloat(json[i].lon), parseFloat(json[i].lat)]);
                    pt2 = ol.proj.fromLonLat([parseFloat(json[i + 1].lon), parseFloat(json[i + 1].lat)]);
                    pt3 = ol.proj.fromLonLat([parseFloat(json[i + 2].lon), parseFloat(json[i + 2].lat)]);
                    pt4 = ol.proj.fromLonLat([parseFloat(json[i + 3].lon), parseFloat(json[i + 3].lat)]);

                    var pyFeature = new ol.Feature(//pyFeature:PolygonFeature
                        new ol.geom.Polygon([[pt1, pt2, pt3, pt4, pt1]])
                        );
                    var Polygon = new ol.style.Style({
                        fill: new ol.style.Fill({
                            color: 'rgba(255, 255, 255,0)',
                        }),
                        stroke: new ol.style.Stroke({
                            color: '#0a4ee6',
                            width: 4
                        })
                    });
                    pyFeature.setStyle(Polygon);
                    Layer.getSource().addFeature(pyFeature);
                }
            }
            map.addLayer(Layer);
            map.getView().fit(Layer.getSource().getExtent());
        };

        //设置加载InSAR的KML文件
        function InSAR_KML(json, name) {//此函数不支持传进来的变量，我也不懂[捂脸]，没搞清楚原因
            var url = "data/" + json[0].url.split('data')[1];
            var extent = [parseFloat(json[0].lon), parseFloat(json[0].lat), parseFloat(json[0].lonend), parseFloat(json[0].latend)];
            var projection = new ol.proj.Projection({//定义坐标系
                code: 'xkcd-image',
                units: 'pixels',
                extent: extent
            });
            //测试动态生成变量
            Vars_InSARKML[name] = new ol.layer.Image({
                source: new ol.source.ImageStatic({
                    url: url,//地址'data/filt_topophase.unw.geo.png'
                    projection: 'EPSG:4326',
                    imageExtent: extent,
                    transition: 0
                })
            });
            map.addLayer(Vars_InSARKML[name]);
        };

        //设置放大缩小的json_zoom获取的函数
        function InSAR_Get_JsonZoom(json, num, json_zoom) {
            var width = parseInt(json[json.length - 1].width) + 1;
            var length = parseInt(json[json.length - 1].length) + 1;
            //json_zoom = [];

            for (var j = 0; j < length; j += num) {//行
                for (var i = 0; i < width; i = i + num) {
                    if ((j * width + i) < json.length) {
                        if (json[j * width + i].settle != "-10000") {
                            json_zoom.push(json[j * width + i]);
                        }
                    }
                }
            }
            console.log(json_zoom);

        };
      
        //设置计算天数函数
        function Calday(sat_Date, end_Date) {
            var sat = sat_Date.slice(0, 4) + "/" + sat_Date.slice(4, 6) + "/" + sat_Date.slice(6);
            var end = end_Date.slice(0, 4) + "/" + end_Date.slice(4, 6) + "/" + end_Date.slice(6);
            var date1 = Date.parse(sat);
            var date2 = Date.parse(end);
            var days = Math.ceil((date2 - date1) / (24.0 * 60.0 * 60.0 * 1000.0));
            return days;
        };

        //设置json数组排序函数
        function sort_by(field, reverse, primer) { //定义排序方法
            var key = primer ?
            function (x) { return primer(x[field]) } :
            function (x) { return x[field] };
            reverse = [-1, 1][+!!reverse];
            return function (a, b) {
                return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
            }
        };

        //设置绘画InSAR时间序列图
        function InSAR_Show_Chart(json, ptsettle) {
            if ((json[json.length - 1].settle == "-10000") || (json[json.length - 2].settle == "-10000")) {
                $("#insarchart").hide();
            } else {
                //cum文件
                var json_sorts = json.filter(function (e) { return e.file == "tscum"; });
                var json_sorte = json_sorts.sort(sort_by('settle', true, parseFloat)); //升序排
                var min = parseFloat(json_sorte[0].settle) * 1.2;
                var max = parseFloat(json_sorte[json_sorte.length - 1].settle) * 1.2;

                var detal = max - min;
                max = max + detal * 0.2;
                min = min - detal * 0.2;
                var cd_interval = Math.ceil((max - min) / 4);
                var min_cum = Math.round(min);
                //incr文件
                json_sorts = json.filter(function (e) { return e.file == "tsincr"; });
                json_sorte = json_sorts.sort(sort_by('settle', true, parseFloat)); //升序排
                min = parseFloat(json_sorte[0].settle) * 1.2;
                max = parseFloat(json_sorte[json_sorte.length - 1].settle) * 1.2;

                detal = max - min;
                max = max + detal * 0.2;
                min = min - detal * 0.2;
                var id_interval = Math.ceil((max - min) / 4);
                var min_incr = Math.round(min);
                //时间计算
                json_sorte = json_sorts.sort(sort_by('date', true, parseInt)); //升序排
                min = json_sorte[0].date;
                max = json_sorte[json_sorte.length - 1].date;
                detal = Calday(min, max);//
                var md_interval = Math.ceil(detal / 30.0 / 8.0/2.0); //一半的间隔
                var min_yr = new Date(min.slice(0, 4) + "/01/01");
                console.log(json_sorte);

                //设置沉降点的位置和样式
                var xx = 0.003999999333335, yy = 0.99999800000016;
                var strhtml = "";
                //画折线图
                var strhtml_cline='<path fill="none" d="M ';
                var strhtml_iline = '<path fill="none" d="M ';
                var clineflag = 0;
                var ilineflag = 0;

                //开始画图
                for (var i = 0; i < (json.length - 1) * 2 / 3; i++) {
                    var X, Y;
                    var dd = Calday(min.slice(0, 4) + "0101", json[i].date);
                    if (json[i].settle != "-1000") {
                        var fill;
                        var dy;
                        if (json[i].file == "tscum") {
                            fill = "#7cb5ec";
                            if (parseFloat(json[i].settle) < 0) {
                                Y = 111.5 + (json[i].settle - (min_cum + 2 * cd_interval)) / 2 / cd_interval * 107;
                            }
                            else {
                                Y = 111.5 - (json[i].settle - (min_cum + 2 * cd_interval)) / 2 / cd_interval * 107;
                            }
                            dy = parseFloat(json[i + (json.length - 1) * 2 / 3].settle);

                            //用于画线的判断
                            clineflag++;
                        }
                        if (json[i].file == "tsincr") {
                            fill = "#FF8000";
                            if (parseFloat(json[i].settle) < 0) {
                                Y = 111.5 + (json[i].settle - (min_incr + 2 * id_interval)) / 2 / id_interval * 107;
                            }
                            else {
                                Y = 111.5 - (json[i].settle - (min_incr + 2 * id_interval)) / 2 / id_interval * 107;
                            }
                            dy = parseFloat(json[i + (json.length - 1) / 3].settle);

                            //用于画线的判断
                            ilineflag++;
                        }

                        /*时间原点（图框左下角点）到第一个月份的x轴隔37.25,
                        时间原点的位置是7.5,第一个月份的位置是44.75,
                        乘以30指的是每月平均30天*/
                        X = 37.25 / (md_interval * 30.0) * dd + 7.5;
                        //圆点的
                        var sm = X.toString() + " " + Y.toString();
                        var sc = (X + xx).toString() + " " + (Y - 1 + yy).toString();
                        //误差的竖线
                        var em = X.toString() + " " + (Y - dy * 5 - 10).toString();
                        var el = X.toString() + " " + (Y + dy * 5).toString();
                        //误差的横线
                        var em1 = (X - 3).toString() + " " + (Y - dy * 5 - 10).toString();
                        var el1 = (X + 3).toString() + " " + (Y - dy * 5 - 10).toString();
                        var em2 = (X - 3).toString() + " " + (Y + dy * 5).toString();
                        var el2 = (X + 3).toString() + " " + (Y + dy * 5).toString();
                        strhtml += ' <path fill="' + fill + '" d="M ' + sm + ' A 4 4 0 1 1 ' + sc + ' Z" opacity="1" class="highcharts-point highcharts-color-0"></path>';
                        strhtml += '<path fill="none" class="highcharts-plot-line " stroke="' + fill + '" stroke-width="1" d="M ' + em + ' L ' + el + '"></path>';
                        strhtml += '<path fill="none" class="highcharts-plot-line " stroke="' + fill + '" stroke-width="1" d="M ' + em1 + ' L ' + el1 + '"></path>';
                        strhtml += '<path fill="none" class="highcharts-plot-line " stroke="' + fill + '" stroke-width="1" d="M ' + em2 + ' L ' + el2 + '"></path>';
                        if (json[i].file == "tscum") {
                            if (clineflag== 1) {
                                strhtml_cline += (X + xx - 10).toString() + " " + (Y - 6 + yy).toString() + ' ';
                            } else {
                                strhtml_cline += ' L ' + (X + xx - 10).toString() + " " + (Y - 6 + yy).toString() + ' ';
                            }
                        } else if(json[i].file == "tsincr") {
                            if (ilineflag == 1) {
                                strhtml_iline += (X + xx - 10).toString() + " " + (Y - 6 + yy).toString() + ' ';
                            } else {
                                strhtml_iline += ' L ' + (X + xx - 10).toString() + " " + (Y - 6 + yy).toString() + ' ';
                            }
                        }


                    }
                }
                strhtml_cline += '" class="highcharts-graph" data-z-index="1" stroke="#7cb5ec" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"></path>';
                strhtml_iline += '" class="highcharts-graph" data-z-index="1" stroke="#FF8000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"></path>';

                document.getElementById('chart_line').innerHTML = strhtml_cline+ strhtml_iline;
                document.getElementById('chart_pt').innerHTML = strhtml;
                document.getElementById('chart_v').innerHTML = 'v: ' + ptsettle.toString() + ' ± ' + (parseFloat(json[json.length - 1].settle).toFixed(2)).toString() + ' mm/yr';

                /*蓝色累积量坐标轴间隔*/
                document.getElementById('axis_c_b1').innerHTML = min_cum;
                document.getElementById('axis_c_b2').innerHTML = min_cum + cd_interval;
                document.getElementById('axis_c_m').innerHTML = min_cum + cd_interval * 2;
                document.getElementById('axis_c_t2').innerHTML = min_cum + cd_interval * 3;
                document.getElementById('axis_c_t1').innerHTML = min_cum + cd_interval * 4;
                /*橙色增量坐标轴间隔*/
                document.getElementById('axis_i_b1').innerHTML = min_incr;
                document.getElementById('axis_i_b2').innerHTML = min_incr + id_interval;
                document.getElementById('axis_i_m').innerHTML = min_incr + id_interval * 2;
                document.getElementById('axis_i_t2').innerHTML = min_incr + id_interval * 3;
                document.getElementById('axis_i_t1').innerHTML = min_incr + id_interval * 4;
                /*时间坐标轴间隔*/
                min_yr.setMonth(min_yr.getMonth() + md_interval);
                document.getElementById('date_axis_1').innerHTML = min_yr.getFullYear() + "."+(min_yr.getMonth()+1);
                min_yr.setMonth(min_yr.getMonth() + md_interval*2);
                document.getElementById('date_axis_2').innerHTML = min_yr.getFullYear() + "." + (min_yr.getMonth() + 1);
                min_yr.setMonth(min_yr.getMonth() + md_interval * 2);
                document.getElementById('date_axis_3').innerHTML = min_yr.getFullYear() + "." + (min_yr.getMonth() + 1);
                min_yr.setMonth(min_yr.getMonth() + md_interval * 2);
                document.getElementById('date_axis_4').innerHTML = min_yr.getFullYear() + "." + (min_yr.getMonth() + 1);
                min_yr.setMonth(min_yr.getMonth() + md_interval * 2);
                document.getElementById('date_axis_5').innerHTML = min_yr.getFullYear() + "." + (min_yr.getMonth() + 1);
                min_yr.setMonth(min_yr.getMonth() + md_interval * 2);
                document.getElementById('date_axis_6').innerHTML = min_yr.getFullYear() + "." + (min_yr.getMonth() + 1);
                min_yr.setMonth(min_yr.getMonth() + md_interval * 2);
                document.getElementById('date_axis_7').innerHTML = min_yr.getFullYear() + "." + (min_yr.getMonth() + 1);
                min_yr.setMonth(min_yr.getMonth() + md_interval * 2);
                document.getElementById('date_axis_8').innerHTML = min_yr.getFullYear() + "." + (min_yr.getMonth() + 1);
                /*时间序列图的显示*/
                $("#insarchart").show();
            }
        };

        //调用jquery查询InSAR并显示多边形
        $('#Search_InSAR').click(function () {
            //清除多边形和点云图层的要素并移除图层
            ClearLayer(vectorLayer_InSAR_Polygon, false);
            ClearLayer(vectorLayer_InSARZoomIn, false);

            //获取查询的参数
            //项目的获取
            //var iproject = $('#iproject option:selected').val();//选中的值

            var iproject = "";//获取项目名字符串  
            var project_val = $('#iproject option:selected');//获取已选项目的数组对象        
            if (project_val.length < 1) {
                alert("请勾选项目！");
            }
            for (var i = 0; i < project_val.length; i++) {
                if (project_val[i].value == "选择全部") { continue; };
                iproject += project_val[i].value;
                if (i < project_val.length - 1) {
                    iproject += ",";
                }
            }
            //其他参数的获取
            var isatellite = $('#isatellite option:selected').val();
            var itrack = $('#itrack option:selected').val();
            var iframe = $('#iframe option:selected').val();
            var imode = $('#imode option:selected').val();
            var iflight_Dir = $('#iflight_Dir option:selected').val();
            var idate = document.getElementById('idate').value;
            var iform = $('#iform option:selected').val();
            var NodesInSAR = [{ id: 1, pId: 0, name: "result", checked: false, isParent: true, open: true }];

            //进行后台请求数据库数据资源
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: encodeURI("/Handler.ashx"),
                data: { action: "getInSAR_Polygon", project: iproject, satellite: isatellite, track: itrack, frame: iframe, mode: imode, flight_Dir: iflight_Dir, date: idate, form: iform },
                success: function (mes) {
                    json_polygon = eval(mes);
                    InSAR_Show_Polygon(json_polygon, vectorLayer_InSAR_Polygon);

                    for (var i = 0, j = 0; i < json_polygon.length; i += 4, j++) {
                        var k1 = json_polygon[i].startdate.split(" ")[0];
                        var k2 = json_polygon[i].enddate.split(" ")[0];
                        var strname = json_polygon[i].satellite + "_" + json_polygon[i].track + "_" + json_polygon[i].frame + "_" + json_polygon[i].mode + "_" + json_polygon[i].flight_dir + "_" + k1 + "_" + k2 + "_" + json_polygon[i].w + "_" + json_polygon[i].l + "_" + json_polygon[i].form + "_" + json_polygon[i].project;
                        var pp = { id: 11 + j, pId: 1, name: strname, checked: false, isParent: false };
                        NodesInSAR[j + 1] = pp;
                    }
                    //初始化Layers菜单栏的InSAR目录树
                    $.fn.zTree.init($("#treeDemoInSAR"), settingInSAR, NodesInSAR);
                }
            });

        });

        //调用jquery按照设置的去除点的百分比重新设置点云的样式
        $('#Edit_Colorbar_Finish').click(function () {
            var percent = $('#edit_colorbar_percentval').val();
            if (percent > 1 || percent < 0) {
                alert("请重新输入百分比(0~1)");
            } else {
                $("#Edit_Colorbar").fadeToggle();
                var percent = document.getElementById('edit_colorbar_percentval').value;
                var json_sorts = json_zoom0.filter(function (e) { return e.settle != -10000; });
                var json_sorte = json_sorts.sort(sort_by('settle', true, parseFloat)); //升序排

                var n_min = parseInt(json_sorte.length * (1.0 - percent) / 2);
                var n_max = json_sorte.length - parseInt(json_sorte.length * (1 - percent) / 2);
                var min = parseFloat(json_sorte[n_min].settle);
                var max = parseFloat(json_sorte[n_max - 1].settle);
                document.getElementById('colorbar_max').value = max.toFixed(1);
                document.getElementById('colorbar_min').value = min.toFixed(1);

                var f = vectorLayer_InSARZoomIn.getSource().getFeatures();
                for (var i = 0; i < f.length; i++) {
                    var h_val = f[i].values_.settle;

                    if (h_val > max) {
                        h_val = max;
                    } else if (h_val < min) {
                        h_val = min;
                    }
                    vectorLayer_InSARZoomIn.getSource().getFeatures()[i].setStyle(Style_Color(f[i], h_val, 4));
                }               
            }
        });
       
        //设置目录树不显示图标
        function showIconForTree(treeId, treeNode) {
            return treeNode.isParent;
        };

        //生成Layers菜单的InSAR目录树
        var settingInSAR = {
            view: {
                showIcon: showIconForTree
            },
            check: {
                enable: true,
                nocheckInherit: true
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                onCheck: onCheck_InSAR,
            }
        };

        function onCheck_InSAR(e, treeId, treeNode) {
            var zTree = $.fn.zTree.getZTreeObj("treeDemoInSAR");
            if (treeNode.checked==true) {
                var iproject = zTree.getCheckedNodes()[0].name;
                var name = treeNode.name;
                name = name.split("_");

                var isatellite = name[0];
                var itrack = name[1];
                var iframe = name[2];
                var imode = name[3];
                var iflight_Dir = name[4];
                var startdate = name[5];
                var enddate = name[6];
                var width = name[7];
                var length = name[8];
                var iform = name[9];
                var project="";
                if (name.length > 10) {
                    for (var i = 10; i < name.length; i++) {
                        project = project + name[i];
                        if (i < name.length - 1) {
                            project = project + "_";
                        }
                    }
                }
                 

                $.ajax({
                    contentType: "application/json;charset:utf-8",
                    url: encodeURI("/Handler.ashx"),
                    data: { action: "getInSAR_Point", project: project, satellite: isatellite, track: itrack, frame: iframe, mode: imode, flight_Dir: iflight_Dir, startdate: startdate, enddate: enddate, form: iform },
                    success: function (mes) {
                        json_pcl = eval(mes);
                        console.log(json_pcl);
                        if (iform == "PointCloud") {

                            Vars_InSARPCL[treeNode.name] = treeNode.name;

                            //InSAR数据的Json数组分级获取 
                            json_zoom0 = json_pcl;
                            InSAR_Get_JsonZoom(json_zoom0, 2, json_zoom1);
                            InSAR_Get_JsonZoom(json_zoom0, 3, json_zoom2);
                            InSAR_Get_JsonZoom(json_zoom0, 5, json_zoom3);
                            InSAR_Get_JsonZoom(json_zoom0, 10, json_zoom4);
                            InSAR_Get_JsonZoom(json_zoom0, 15, json_zoom5);
                            InSAR_Get_JsonZoom(json_zoom0, 20, json_zoom6);
                            InSAR_Get_JsonZoom(json_zoom0, 35, json_zoom7);
                            InSAR_Get_JsonZoom(json_zoom0, 70, json_zoom8);
                            InSAR_Get_JsonZoom(json_zoom0, 140, json_zoom9);

                            //首层InSAR数据的加载显示
                            InSAR_Show_PCL(json_zoom0, 20, width, length, 0, vectorLayer_InSARZoomIn);

                            //图层添加显示
                            map.addLayer(vectorLayer_InSARZoomIn);
                           
                        } else {
                            InSAR_KML(json_pcl, treeNode.name);
                        }
                    }
                });
                vectorLayer_InSAR_Polygon.setVisible(false);
            }
            else if (treeNode.checked == false) {
                //当取消勾选的时候，删除要素并移除图层
                var name = treeNode.name;
                name = name.split("_")[9];
                if (name == "KML") {
                    map.removeLayer(Vars_InSARKML[treeNode.name]);
                } else {
                    ClearLayer(vectorLayer_InSARZoomIn, true);
                }
            }
        };


        /*
        *******************************map模块*******************************
        */
        //按下回车键执行
        $("body").keydown(function () {
            if (event.keyCode == "13") {//keyCode=13是回车键
                var f = vectorLayer_InSARZoomIn.getSource().getFeatures();
                for (var i = 0; i < f.length; i++) {
                    vectorLayer_InSARZoomIn.getSource().getFeatures()[i].setStyle(Style_Color(f[i], f[i].values_.settle, 4));
                }
            }
            if (event.keyCode == 27) {
                $("#gpspopup").hide();
                $("#insarchart").hide();
                $("#gpsexpand").hide();
                $("#firstpane").hide();
                $("#insarexpand").hide();                                           
            }
        });

        //设置地图监听，若当前View的分辨率resolution变化，就执行下面程序
        map.getView().on('change:resolution', function () {
            //设置图例中速度比例值
            var zoomscale = this.getZoom() / 4.0;//获取相比于初始化是(zoom=4)，目前放大的倍数
            var zoomnum = 30.0 / zoomscale;
            document.getElementById('v_zoom').innerHTML = (zoomnum.toFixed(1)).toString() + " mm/yr";

            //GPS注释文字是否可见的监听
            if (this.getZoom() > 7.0) {
                vectorLayer_Label.setVisible(true);

            } else {
                vectorLayer_Label.setVisible(false);
            }

            //GPS速度显示箭头的监听
            if ($('#search_gps_styleselect option:selected')[0].value == "velocity") {
                var f = vectorLayer_GPS.getSource().getFeatures();
                for (var i = 0; i < f.length; i++) {
                    var sf = f[i].getStyle();
                    // 重新设置图标的缩放率，基于层级10来做缩放
                    sf[1].getImage().setScale(this.getZoom() / 8);
                    vectorLayer_GPS.getSource().getFeatures()[i].setStyle(sf);
                }
            }

            //InSAR图层显示的监听
            if (this.getZoom() < 8.0) {

                InSAR_KMLChange(false);
                InSAR_PCLChange(false);
             
            } else {

                InSAR_KMLChange(true);
                InSAR_PCLChange(true);
            };

            //InSAR的Zoom图层的json_zoom数组的赋值   
            InSAR_GetZoomJson(this.getZoom());

        });
       
        //Zoomjson根据地图比例获取对应的zoomjson数据
        function InSAR_GetZoomJson(scale) {
            if (scale > 16.0) {
                json_zoom = json_zoom0;
            } else if (scale > 15.5) {
                json_zoom = json_zoom1;
            } else if (scale > 15.0) {
                json_zoom = json_zoom2;
            } else if (scale > 14.0) {
                json_zoom = json_zoom3;
            } else if (scale > 13.0) {
                json_zoom = json_zoom4;
            } else if (scale > 12.0) {
                json_zoom = json_zoom5;
            } else if (scale > 11.0) {
                json_zoom = json_zoom6;
            } else if (scale > 10.0) {
                json_zoom = json_zoom7;
            } else if (scale > 9.0) {
                json_zoom = json_zoom8;
            } else {
                json_zoom = json_zoom9;
            }
        };

        //KML显示按比例显示隐藏的监听函数
        function InSAR_KMLChange(bool) {
            //KML层的显示/隐藏
            var zTree = $.fn.zTree.getZTreeObj("treeDemoInSAR");
            if (zTree != null) {
                if (zTree.getNodes().length > 0) {
                    var nodes = zTree.getNodes()[0].children;
                    for (var i = 0; i < nodes.length; i++) {
                        if (Vars_InSARKML[nodes[i].name] != undefined) {
                            Vars_InSARKML[nodes[i].name].setVisible(bool);
                        }
                    }
                }
            }
            //多边形层的显示/隐藏
            if (vectorLayer_InSAR_Polygon.getSource().getFeatures().length > 0) {
                vectorLayer_InSAR_Polygon.setVisible(!bool);
            }
        };

        //点云显示按比例显示隐藏的监听函数
        function InSAR_PCLChange(bool) {
            //点云层的显示/隐藏
            vectorLayer_InSARZoomIn.setVisible(bool);

            //多边形层的显示/隐藏
            if (vectorLayer_InSAR_Polygon.getSource().getFeatures().length > 0) {
                if (vectorLayer_InSARZoomIn.getSource().getFeatures().length > 0) {
                    vectorLayer_InSAR_Polygon.setVisible(!bool);
                }
            }
        };

        //屏幕移动时更新点云要素
        function InSAR_MoveShow(json, Layer, bottomLeft, topRight) {
            //清除之前加载的点元素
            ClearLayer(Layer, false);

            for (var i = 0, k = 0; i < json.length; i++) {
                if ((json[i].lon > bottomLeft[0]) & (json[i].lon < topRight[0]) & (json[i].lat > bottomLeft[1]) & (json[i].lat < topRight[1])) {
                    var max = document.getElementById('colorbar_max').value;
                    var min = document.getElementById('colorbar_min').value;
                    if ((parseFloat(json[i].settle) > min) & (parseFloat(json[i].settle) < max)) {
                        var iconFeature = new ol.Feature({
                            geometry: new ol.geom.Point(ol.proj.fromLonLat([parseFloat(json[i].lon), parseFloat(json[i].lat)])),
                            settle: json[i].settle,
                            err: json[i].err
                        });
                        iconFeature.setStyle(Style_Color(iconFeature, json[i].settle,4));
                        Layer.getSource().addFeature(iconFeature);
                    }
                }
                if ((json[i].lon < bottomLeft[1]) & (json[i].lat > topRight[0])) {
                    k++;
                    if (k > 3) { break; }
                }
            }
        };

        //设置地图监听，当地图屏幕出现变化，执行下面程序
        function onMoveEnd(evt) {
            //获取屏幕内四个角点的坐标
            var mapend = evt.map;
            var extent = mapend.getView().calculateExtent(mapend.getSize());
            var bottomLeft = ol.proj.toLonLat(ol.extent.getBottomLeft(extent));
            var topRight = ol.proj.toLonLat(ol.extent.getTopRight(extent));
            var topLeft = [bottomLeft[0], topRight[1]];
            var bottomRight = [topRight[0], bottomLeft[1]];

            if (mapend.getView().getZoom() >= 8.0) {
                //设置大范围的图层可见
                InSAR_MoveShow(json_zoom, vectorLayer_InSARZoomIn, bottomLeft, topRight);
            }else {
                var f = vectorLayer_InSARZoomIn.getSource().getFeatures();
                if (f.length > 0) {
                    for (var i = 0; i < f.length; i++) {
                        vectorLayer_InSARZoomIn.getSource().removeFeature(f[i]);
                    }
                    vectorLayer_InSARZoomIn.setVisible(false);
                }
                
            }
        };
        map.on('moveend', onMoveEnd);

        //设置单击地图，执行下列程序
        map.on('singleclick', function (evt) {
            //获取单击地图的位置坐标
            var coordinate = evt.coordinate;
            var pro = ol.proj.toLonLat(coordinate);

            //进行GPS点的判断,显示其点位信息
            var fg = vectorLayer_GPS.getSource().getFeatures();
            if (fg.length>0) {
                for (var i = 0; i < json_pt.length; i++) {
                    var d_lon = json_pt[i].lon - pro[0];
                    var d_lat = json_pt[i].lat - pro[1];
                    if ((Math.abs(d_lat) < 0.01) && (Math.abs(d_lon) < 0.01)) {
                        GPS_Show_Popup(json_pt, i);
                    }
                }
            }

            //进行InSAR点的判断并显示时间序列信息
            var f = vectorLayer_InSARZoomIn.getSource().getFeatures();
            if (f.length > 0) {
                for (var i = 0; i < f.length; i++) {
                    var prof = ol.proj.toLonLat(f[i].values_.geometry.flatCoordinates);
                    var d_lon = prof[0] - pro[0];
                    var d_lat = prof[1] - pro[1];
                    if ((Math.abs(d_lat) < 0.0007) && (Math.abs(d_lon) < 0.0007)) {
                        var InSAR_settle = f[i].values_.settle;

                        var zTree = $.fn.zTree.getZTreeObj("treeDemoInSAR");
                        var name = zTree.getCheckedNodes()[1].name;
                        var project = zTree.getCheckedNodes()[0].name;
                        name = name.split("_");
                        var urlStr = encodeURI("/Handler.ashx");
                        $.ajax({
                            contentType: "application/json;charset:utf-8",
                            url: urlStr,
                            data: { action: "getInSAR_TimeSeries", date: json_zoom[i].date, w: json_zoom[i].width, l: json_zoom[i].length, project: project, width: name[7], length: name[8] },
                            success: function (mes) {
                                json_chart_total = eval(mes);                               
                                InSAR_Show_Chart(json_chart_total, parseFloat(f[i].values_.settle).toFixed(2));

                                //添加InSAR点云的浮云窗
                                var InSAR_str = '<code>velocity: ' + parseFloat(f[i].values_.settle).toFixed(2).toString()+ '± ' + f[i].values_.err.toString() + 'mm/yr<code>';
                                /*if (InSAR_settle != "") {
                                    if (json_chart_total[json_chart_total.length - 1].settle != "-10000") {
                                        var InSAR_std = parseFloat(json_chart_total[json_chart_total.length - 1].settle).toFixed(2);
                                        InSAR_str += '± ' + InSAR_std.toString() + 'mm/yr<code>';
                                    } else {
                                        InSAR_str += 'mm/yr<code>';
                                    }
                                    
                                    InSAR_content.innerHTML = InSAR_str;
                                    InSAR_overlay.setPosition(coordinate);
                                }*/
                                InSAR_content.innerHTML = InSAR_str;
                                InSAR_overlay.setPosition(coordinate);
                            }
                        });
                        break;
                    }
                }
            }
           
        });

        //定义并添加图层切换控件
        var layerSwitcher = new ol.control.LayerSwitcher({
            tipLabel: 'Légende',
            type : 'radio'
        });
        map.addControl(layerSwitcher);
       
        //设置拖动到地图添加显示GPX,GeoJSON,IGC,KML,TopoJSON文件数据
        dragAndDropInteraction.on('addfeatures', function (event) {
            var vectorSource = new ol.source.Vector({
                features: event.features
            });
            map.addLayer(new ol.layer.Vector({
                renderMode: 'image',
                source: vectorSource
            }));
            map.getView().fit(vectorSource.getExtent());
        });

        //时间设置
        lay('#version').html('-v' + laydate.v);

        //实例化时间
        laydate.render({
            elem: '#date',  //指定元素
            range: true
        });

        laydate.render({
            elem: '#idate',  //指定元素
            range: true
        });

        laydate.render({
            elem: '#editgpsdate',  //指定元素
            lang: 'en'
        });


        /*
        *******************************其他模块********************************
        */
        //导入kml,geojson数据文件的import功能
        function selectFile() { document.getElementById("dataimport").click(); }

        function setBlogrollImageName() {
            var inputBox = document.getElementById("dataimport");
            var reader = new FileReader();
            reader.readAsDataURL(inputBox.files[0]);//发起异步请求
            reader.onload = function () {
                //获得Other的目录树
                var treeObj = $.fn.zTree.getZTreeObj("treeDemoOther");
                //查找是否存在相同的文件名
                var old_url = json_other.filter(function (p) {
                    return p.name == inputBox.files[0].name;
                });
                //若存在，则进行文件名修改
                var newjsonname=inputBox.files[0].name;
                if (old_url.length > 0) {
                    var newname = newjsonname.split('.');
                    newjsonname=newname[0]+'(1).'+newname[1];
                }
                //把导入的数据文件名和路径添加到json数组
                var newJson = { 'name': newjsonname, 'url': this.result };
                json_other.push(newJson);
                //目录树增加子结点
                var newNode = { name: newjsonname };
                treeObj.addNodes(null, newNode);
            }
        };


        //初始化Layers菜单的Other目录树settingOther
        var SettingLyOther = {
            view: {
                showIcon: showIconForTree
            },
            check: {
                enable: true,
                nocheckInherit: true
            },
            async: {
                enable: true,
                url: "/Handler.ashx?action=getLayers_Other&level=0",
                dataFilter: filter
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                onCheck: OtherShow,
            }
        };
       
        function OtherShow(event, treeId, treeNode) {
            if (true == treeNode.checked) {
                if (treeNode.name.split('.')[1] == "kml") {
                    var kmlurl = json_other.filter(function (p) {
                        return p.name == treeNode.name;
                    });

                    Vars_Other[treeNode.name] = new ol.layer.Vector({
                        source: new ol.source.Vector({
                            url: kmlurl[0].url,
                            format: new ol.format.KML()
                        })
                    });
                }
                else if (treeNode.name.split('.')[1] == "geojson") {
                    var geourl = json_other.filter(function (p) {
                        return p.name == treeNode.name;
                    });
                    Vars_Other[treeNode.name] = new ol.layer.Vector({
                        source: new ol.source.Vector({
                            url: geourl[0].url,
                            format: new ol.format.GeoJSON()
                        })
                    });
                }
                map.addLayer(Vars_Other[treeNode.name]);
            }
            else if (false == treeNode.checked) {
                map.removeLayer(Vars_Other[treeNode.name]);
            }
        };

        //定义Other的json数组的全局变量
        var json_other = "";

        //调用jquery进行后台数据库请求
        $(function () {
            //请求数据库数据
            $.ajax({
                contentType: "application/json;charset:utf-8",
                url: encodeURI("/Handler.ashx"),
                data: { action: "getLayers_Other" ,level:1},
                success: function (mes) {
                    json_other = eval(mes);
                }
            });

            //初始化Other目录树
            $.fn.zTree.init($("#treeDemoOther"), SettingLyOther);
        });

        //InSAR的KML数据图层的清除
        function InSAR_KMLClear() {

            var zTree = $.fn.zTree.getZTreeObj("treeDemoInSAR");
            if (zTree != null) {
                if (zTree.getNodes().length > 0) {
                    var nodes = zTree.getNodes()[0].children;
                    for (var i = 0; i < nodes.length; i++) {
                        var name = nodes[i].name;
                        name = name.split("_")[9];
                        if (name == "KML") {
                            if (Vars_InSARKML[nodes[i].name] != undefined) {
                                map.removeLayer(Vars_InSARKML[nodes[i].name]);
                            }
                        }
                    }
                }
            }

        };

        //Other数据图层的清除
        function Other_Clear() {

            var zTree = $.fn.zTree.getZTreeObj("treeDemoOther");
            if (zTree != null) {
                if (zTree.getNodes().length > 0) {
                    var nodes = zTree.getNodes();
                    for (var i = 0; i < nodes.length; i++) {
                        var name = nodes[i].name;

                        if (Vars_Other[nodes[i].name] != undefined) {
                            map.removeLayer(Vars_Other[nodes[i].name]);
                        }

                    }
                }
            }

        };

        //清除所有数据图层
        $("#Layers_Clear").click(function () {
            //GPS图层的清除
            ClearLayer(vectorLayer_GPS, true);
            ClearLayer(vectorLayer_Label, true);
            //重新初始化目录树
            SettingLyGPS.async.url = "";
            $.fn.zTree.init($("#treeDemoinput"), SettingLyGPS, []);
            //浮云窗隐藏
            $("#gpspopup").hide();
            
            //InSAR图层的清除
            ClearLayer(vectorLayer_InSARZoomIn, true);
            ClearLayer(vectorLayer_InSAR_Polygon, true);
            InSAR_KMLClear();
 
            //重新初始化目录树
            $.fn.zTree.init($("#treeDemoInSAR"), settingInSAR, []);
            //InSAR序列图隐藏
            $("#insarchart").hide();

            //Other图层的清除
            Other_Clear();
            //重新初始化目录树
            $.fn.zTree.init($("#treeDemoOther"), SettingLyOther,[]);
            
        });
        
        //JQuery文档初始化
        $(document).ready(function () {
            //Layers菜单
            $("#file").click(function () {//Layers导航窗体显示
                $("#firstpane").toggle("slow");
                //保持layers搜索显示，GPS和insar的隐藏
                $("#gpsexpand").fadeOut("slow");
                $("#insarexpand").fadeOut("slow");
            });
           
            $("#Layers_Close").click(function () {//设置窗体关闭按键
                $("#firstpane").toggle("slow");
            });

            //InSAR菜单         
            $("#ipro").click(function () {//InSAR查询窗体显示
                $("#insarexpand").fadeIn("slow");
                //保持insar搜索显示，GPS和layers的隐藏
                $("#firstpane").fadeOut("slow");
                $("#gpsexpand").fadeOut("slow");
            });

            $("#CloseInSAR").click(function () {//设置窗体关闭“×”
                $("#insarexpand").fadeOut();
            });

            $("#Search_InSAR_CloseBt").click(function () {//设置窗体关闭按键
                $("#insarexpand").fadeOut("slow");
            });

            $("#chart_hide").click(function () {//设置时间序列窗体关闭“×”
                $("#insarchart").hide();
            });
            
            $("#Edit_Colorbar_Logo").click(function () {//InSAR点云的颜色设置窗体显示
                $("#Edit_Colorbar").show();
            });
            $("#Edit_Colorbar_Close").click(function () {//设置窗体关闭“×”
                $("#Edit_Colorbar").hide();
            });
            $("#Edit_Colorbar_CloseBt").click(function () {//设置窗体关闭按键
                $("#Edit_Colorbar").hide();
            });
            
            
            //GPS菜单
            $("#gpro").click(function () {//GPS查询窗体显示
                $("#gpsexpand").fadeIn("slow");
                //保持GPS搜索显示，insar和layers的隐藏
                $("#firstpane").fadeOut("slow");
                $("#insarexpand").fadeOut("slow");
            });

            $("#CloseGPS").click(function () {//设置窗体关闭“×”
                $("#gpsexpand").fadeOut("slow");
            });
            $("#Search_GPS_CloseBt").click(function () {//设置窗体关闭按键
                $("#gpsexpand").fadeOut("slow");
            });
                      
            $("#Edit_GPS_Close").click(function () {//设置窗体关闭“×”
                $("#Edit_GPS").fadeOut("slow");
            });

            $("#Edit_GPS_CloseBt").click(function () {//设置窗体关闭按键
                $("#Edit_GPS").fadeOut("slow");
            });

            $("#CloseGPSPopup").click(function () {//GPS点位信息的窗体显示
                $("#gpspopup").fadeOut("slow");
            });

            $("#pt_img").mouseover(function () {//点位信息的序列图显示
                $("#pt_img_show").show();
            });
            $("#pt_img").mouseleave(function () {//点位信息的序列图隐藏
                $("#pt_img_show").hide();
            });
            
            //数据管理
            $("#Datamanagement").click(function () {
                var name = document.cookie.split(';')[0].split('=')[1];
                var flag = 0;
                var mark = 0;
                VerifyCookie(name, flag, mark);
            });

            //用户管理
            $("#Adminmanagement").click(function () {
                var name = document.cookie.split(';')[0].split('=')[1];
                var flag = 1;
                var mark = 0;
                VerifyCookie(name, flag, mark);
            });
            
        });
    </script>


</body>
</html>
